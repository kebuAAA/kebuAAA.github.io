<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SQL | 小明的博客</title><meta name="author" content="爱编程的小明"><meta name="copyright" content="爱编程的小明"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#e68ab8"><meta name="description" content="关系型数据库的命名是因为数据库展现了表单形式的不同类型数据之间的关系。 SQL 是结构化数据查询语言，是我们用来像数据管理系统（Data Management system）下达指令时用到的. Sqlite 是一个轻量的 DBMS。 SQL SQL 既不是一个 API 也不是一种协议，而是一种声"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://kobal.top/SQL/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//www.clarity.ms"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?4e3a07c287f8fb6cfc09bf5a7fdc1dd7";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "e8bjif1knd");</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":120},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SQL',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-03-27 00:16:00'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#e68ab8')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><style>#article-container.post-content h1:before, h2:before, h3:before, h4:before, h5:before, h6:before { -webkit-animation: avatar_turn_around 1s linear infinite; -moz-animation: avatar_turn_around 1s linear infinite; -o-animation: avatar_turn_around 1s linear infinite; -ms-animation: avatar_turn_around 1s linear infinite; animation: avatar_turn_around 1s linear infinite; }</style><link rel="stylesheet" href="/Scripts/css/transparent.css"><link rel="stylesheet" href="/Scripts/css/font.css"><link rel="stylesheet" href="/Scripts/css/foot_style.css"><link rel="stylesheet" href="/Scripts/css/twikoo_beautify.css"><link rel="stylesheet" href="/Scripts/css/tags.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/animate.css/4.1.1/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="/img/avatar.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">100</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">57</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 存档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/wallpaper/"><i class="fa-fw fas fa-image fa-fw"></i><span> 壁纸</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fa fa-subway"></i><span> 开往</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="小明的博客"><span class="site-name">小明的博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 存档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/wallpaper/"><i class="fa-fw fas fa-image fa-fw"></i><span> 壁纸</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fa fa-subway"></i><span> 开往</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">SQL<a class="post-edit-link" href="https://github.dev/kebuAAA/myblog/blob/main/source/_posts/SQL.md" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-03-25T16:16:00.000Z" title="发表于 2022-03-26 00:16:00">2022-03-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-03-26T16:16:00.000Z" title="更新于 2022-03-27 00:16:00">2022-03-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">数据分析</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SQL"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><iframe src="../assets/SQL_mindmap.html" width="100%" height="500px" frameborder="0" loading="lazy" allowfullscreen></iframe>
<p><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../md_imgs/SQL/0.png" alt="SQL语法速成手册 (1).png"><br>
关系型数据库的命名是因为数据库展现了表单形式的不同类型数据之间的关系。<br>
SQL 是结构化数据查询语言，是我们用来像数据管理系统（Data Management system）下达指令时用到的.<br>
Sqlite 是一个轻量的 DBMS。</p>
<h1 id="sql">SQL</h1>
<p>SQL 既不是一个 API 也不是一种协议，而是一种声明式语言，只需要告诉它做什么即可。<br>
它是关系型数据库的通用语言。SQL 查询是客户端发送给数据库服务器的文本字符串，指明需要执行的具体操作。</p>
<ul>
<li>
<p>SQL is everywhere</p>
</li>
<li>
<p>SQL enables us to pull data from many sources</p>
</li>
</ul>
<p>SQL 语句的三种类型：</p>
<ul>
<li>
<p>DDL（Data Definition Language，数据定义语言）：处理用户、数据库以及表单的创建、删除、约束和权限等</p>
</li>
<li>
<p>DML（Data Manipulation Language，数据操纵语言） 用来查询或者变更表中的记录。</p>
</li>
<li>
<p>DCL（Data Control Language，数据控制语言） 用来确认或者取消对数据库中的数据进行的变更。除此之外，还可以对 RDBMS 的用户是否有权限操作数据库中的对象（数据库表等）进行设定。DCL 包含以下几种指令。</p>
<ul>
<li>
<p>COMMIT ： 确认对数据库中的数据进行的变更</p>
</li>
<li>
<p>ROLLBACK ： 取消对数据库中的数据进行的变更</p>
</li>
<li>
<p>GRANT ： 赋予用户操作权限</p>
</li>
<li>
<p>REVOKE ： 取消用户的操作权限</p>
</li>
</ul>
</li>
</ul>
<p>基本的 DDL 命令</p>
<table>
<thead>
<tr>
<th>创建数据库</th>
<th><strong>CREATE</strong> DATEBASE dbname</th>
</tr>
</thead>
<tbody>
<tr>
<td>选择当前数据库</td>
<td>USE dbname</td>
</tr>
<tr>
<td>删除数据库以及表单</td>
<td><strong>DROP</strong> DATABASE dbname</td>
</tr>
<tr>
<td>创建表单</td>
<td>CREATE TABLE tbname （col defs）</td>
</tr>
<tr>
<td>删除表单</td>
<td>DROP TABLE tbname</td>
</tr>
<tr>
<td>删除表单中的所有行</td>
<td>TRUNCATE TABLE tbname</td>
</tr>
<tr>
<td>修改数据库和表的结构</td>
<td><strong>ALTER</strong></td>
</tr>
</tbody>
</table>
<p>DML 命令</p>
<table>
<thead>
<tr>
<th>需求</th>
<th>命令</th>
</tr>
</thead>
<tbody>
<tr>
<td>增加行</td>
<td>INSERT INTO tbname VALUES（）</td>
</tr>
<tr>
<td>增加行的部分内容</td>
<td>INSERT INTO user(col_name) VALUES（）</td>
</tr>
<tr>
<td>删除部分行</td>
<td>DELETE FROM tbname WHERE condition</td>
</tr>
<tr>
<td>选择部分行和部分列</td>
<td>SELECT col_name FROM tbname WHERE condition</td>
</tr>
<tr>
<td>查询表长</td>
<td>count(*)避免缺失值的影响</td>
</tr>
<tr>
<td>查询不重复行</td>
<td>SELECT DISTINCT</td>
</tr>
<tr>
<td>限制显示的行数</td>
<td>limit 3</td>
</tr>
<tr>
<td>查询值命名</td>
<td>AS<br />列名可以紧跟在列后边，加一个’’（提倡）<br /># SElECT SUM(Total) ‘Total Students’ FROM recent_grads<br />名称有空格要加AS’’<br /># SELECT SUM(Total) AS ‘Total Students’ FROM recent_grads<br /></td>
</tr>
<tr>
<td>（限制返回 2-5 行）查询所有行和所有列</td>
<td>SELECT * FROM tbname（LIMIT 2,5）</td>
</tr>
<tr>
<td>修改一列的部分行</td>
<td>UPDATE tbname SET col_name=value WHERE condition</td>
</tr>
</tbody>
</table>
<p>列名也可以用数字代替（表的索引）</p>
<h1 id="基本书写规则">基本书写规则</h1>
<ul>
<li>
<p>语句以；结束</p>
</li>
<li>
<p><strong>不区分关键字的大小写</strong>，插入表中的数据除外</p>
<ul>
<li>
<p>win 系统不区分表名和字段 名的大小写</p>
</li>
<li>
<p>linux/mac 区分</p>
</li>
</ul>
</li>
</ul>
<h2 id="表的创建">表的创建</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">CREATE TABLE &lt; 表名 &gt;</span><br><span class="line">( &lt; 列名 <span class="number">1</span>&gt; &lt; 数据类型 &gt; &lt; 该列所需约束 &gt; ,</span><br><span class="line">  &lt; 列名 <span class="number">2</span>&gt; &lt; 数据类型 &gt; &lt; 该列所需约束 &gt; ,</span><br><span class="line">  &lt; 列名 <span class="number">3</span>&gt; &lt; 数据类型 &gt; &lt; 该列所需约束 &gt; ,</span><br><span class="line">  &lt; 列名 <span class="number">4</span>&gt; &lt; 数据类型 &gt; &lt; 该列所需约束 &gt; ,</span><br><span class="line">  .</span><br><span class="line">  .</span><br><span class="line">  .</span><br><span class="line">  &lt; 该表的约束 <span class="number">1</span>&gt; , &lt; 该表的约束 <span class="number">2</span>&gt; ,……);</span><br></pre></td></tr></table></figure>
<p>约束条件主要分为两种：</p>
<ul>
<li>
<p>非空约束：NOT NULL</p>
</li>
<li>
<p>主键约束:PRIMARY KEY</p>
</li>
<li>
<p>默认值约束：DEFAULT</p>
</li>
</ul>
<p>数据类型：</p>
<ul>
<li>
<p>INTEGER</p>
</li>
<li>
<p>CHAR</p>
</li>
<li>
<p>VARCHAR</p>
</li>
<li>
<p>DATE</p>
</li>
</ul>
<h2 id="表的删除和更新">表的删除和更新</h2>
<h3 id="表的删除：">表的删除：</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DROP TABLE &lt;表名&gt;</span><br></pre></td></tr></table></figure>
<h3 id="表的修改-alter-table-：">表的修改（ALTER TABLE）：</h3>
<p>ALTER TABLE 和 DROP TABLE 一样会删除整张表，但是 ALTER TABLE 可以进行列的增删:<br>
添加列：<strong>ALTER</strong> <strong>TABLE</strong> <strong>&lt;</strong> 表名 <strong>&gt;</strong> ADD COLUMN <strong>&lt;</strong> 列的定义 <strong>&gt;</strong><br>
删除列：<strong>ALTER</strong> <strong>TABLE</strong> <strong>&lt;</strong> 表名 <strong>&gt;</strong> <strong>DROP</strong> COLUMN <strong>&lt;</strong> 列名 <strong>&gt;</strong>;</p>
<h3 id="表的清空">表的清空</h3>
<p>TRUNCATE <strong>TABLE</strong> TABLE_NAME;<br>
优点：相比 drop/delete，truncate 用来清除数据时，速度最快。</p>
<h2 id="插入数据">插入数据</h2>
<p><strong>INSERT</strong> <strong>INTO</strong> <strong>&lt;<strong>表名</strong>&gt;</strong> (列1, 列2, 列3, ……) <strong>VALUES</strong> (值1, 值2, 值3, ……);<br>
对表进行全列 INSERT 时，可以省略表名后的列清单。这时 VALUES 子句的值会默认按照从左到右的顺序赋给每一列。<br>
很多 RDBMS 也支持同时插入多行数据：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- Oracle中的多行INSERT</span><br><span class="line">INSERT ALL INTO productins VALUES (&#x27;0002&#x27;, &#x27;打孔器&#x27;, &#x27;办公用品&#x27;, 500, 320, &#x27;2009-09-11&#x27;)</span><br><span class="line">INTO productins VALUES (&#x27;0003&#x27;, &#x27;运动T恤&#x27;, &#x27;衣服&#x27;, 4000, 2800, NULL)</span><br><span class="line">INTO productins VALUES (&#x27;0004&#x27;, &#x27;菜刀&#x27;, &#x27;厨房用具&#x27;, 3000, 2800, &#x27;2009-09-20&#x27;)</span><br></pre></td></tr></table></figure>
<h3 id="数据的更新">数据的更新</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UPDATE &lt;表名&gt;</span><br><span class="line">SET &lt;列名&gt; = &lt;表达式&gt; [, &lt;列名2&gt;=&lt;表达式2&gt;...];</span><br><span class="line">WHERE &lt;条件&gt;;  -- 可选，非常重要。</span><br><span class="line">ORDER BY 子句;  --可选</span><br><span class="line">LIMIT 子句; --可选</span><br></pre></td></tr></table></figure>
<h1 id="查询数据">查询数据</h1>
<h2 id="数据运算与比较">数据运算与比较</h2>
<h3 id="算术运算与比较运算">算术运算与比较运算</h3>
<p><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../md_imgs/SQL/1.png" alt="image.png"></p>
<ul>
<li>IN：通常写在 where 从句中，用于匹配，也可以写进去 subquery</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT Major_category, Major</span><br><span class="line">  FROM recent_grads</span><br><span class="line"> WHERE Major_category IN</span><br><span class="line"> (</span><br><span class="line"> SELECT Major_category</span><br><span class="line">  FROM recent_grads</span><br><span class="line"> GROUP BY Major_category</span><br><span class="line"> ORDER BY SUM(TOTAL) DESC</span><br><span class="line">LIMIT 3</span><br><span class="line"> )</span><br></pre></td></tr></table></figure>
<h3 id="逻辑运算">逻辑运算</h3>
<p>SQL 的逻辑运算并不只是简单的 True 和 False 的逻辑运算，因为 SQL 中可能出现的一种数据值为<code>NULL</code>。这使得 SQL 的逻辑运算变成了三值逻辑：<br>
<img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../md_imgs/SQL/2.png" alt="image.png"></p>
<h2 id="常用函数">常用函数</h2>
<h3 id="数值计算函数">数值计算函数</h3>
<ul>
<li>
<p>AVG()</p>
</li>
<li>
<p>SUM（col_name,int）</p>
</li>
<li>
<p>ROUND（）:向下取整</p>
</li>
<li>
<p>CAST（col_name AS Float）:整数列转化为实数列</p>
</li>
</ul>
<h3 id="文本处理函数">文本处理函数</h3>
<table>
<thead>
<tr>
<th>函 数</th>
<th>说 明</th>
</tr>
</thead>
<tbody>
<tr>
<td>LEFT()（或使用子字符串函数）</td>
<td>返回字符串左边的字符</td>
</tr>
<tr>
<td>LENGTH()（也使用DATALENGTH()或LEN()）</td>
<td>返回字符串的长度</td>
</tr>
<tr>
<td>LOWER()（Access使用LCASE()）</td>
<td>将字符串转换为小写</td>
</tr>
<tr>
<td>LTRIM()</td>
<td>去掉字符串左边的空格</td>
</tr>
<tr>
<td>RIGHT()（或使用子字符串函数）</td>
<td>返回字符串右边的字符</td>
</tr>
<tr>
<td>RTRIM()</td>
<td>去掉字符串右边的空格</td>
</tr>
<tr>
<td>SOUNDEX()</td>
<td>返回字符串的SOUNDEX值</td>
</tr>
<tr>
<td>UPPER()（Access使用UCASE()）</td>
<td>将字符串转换为大写</td>
</tr>
</tbody>
</table>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT &#x27;Major: &#x27;||LOWER(Major) AS Major,Total,Men,Women,Unemployment_rate,LENGTH(Major) AS Length_of_name</span><br><span class="line">FROM recent_grads</span><br><span class="line">ORDER BY Unemployment_rate DESC;</span><br></pre></td></tr></table></figure>
<p>字符串拼接也可以用<code>concat</code>函数，索引则可以使用<code>substring</code></p>
<h3 id="字符串的模糊匹配-like-字句">字符串的模糊匹配（LIKE 字句）</h3>
<p>在处理字符串相关的列时，往往会用到 like 子句：</p>
<ul>
<li>
<p>where 进行筛选时，可能会用到模糊匹配</p>
</li>
<li>
<p>CASE 创建新的列时，可能会用到 like 子句</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WHERE [column_name] LIKE &quot;pattern&quot;</span><br></pre></td></tr></table></figure>
<p><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../md_imgs/SQL/3.png" alt="image.png"><br>
当然也可以发现直接用列的值进行匹配，因为像是&quot;jen&quot;这样的值不能被匹配，在使用的时候可以考虑加一个 lower（）函数</p>
<h2 id="得到新的列">得到新的列</h2>
<p>一般来说可以通过列的运算与比较来创建新的列，除此以外也可以使用 <code>CASE</code> 语句来创建新的列,主要用于条件筛选的情况:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CASE</span><br><span class="line">WHEN &lt;condition_1&gt; THEN &lt;value_1&gt;</span><br><span class="line">WHEN &lt;condition_2&gt; THEN &lt;value_2&gt;</span><br><span class="line">ELSE &lt;value_3&gt;</span><br><span class="line">END AS &lt;new_column_name&gt;</span><br><span class="line">#如果没有else，未匹配的值会被设为空值</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT Major,Sample_size,</span><br><span class="line">        CASE</span><br><span class="line">        WHEN Sample_size&lt;200 THEN &#x27;Small&#x27;</span><br><span class="line">        WHEN Sample_size&gt;=200 and Sample_size&lt;1000 THEN &#x27;Medium&#x27;</span><br><span class="line">        ELSE &#x27;Large&#x27;</span><br><span class="line">        END AS &#x27;Sample_category&#x27;</span><br><span class="line">FROM recent_grads</span><br></pre></td></tr></table></figure>
<h2 id="分组">分组</h2>
<p><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../md_imgs/SQL/4.png" alt="image.png"><br>
group by 根据指定的列进行分组，然后对每组进行操作（排序，聚合），将会显示出每一组的<strong>最后一个值</strong></p>
<h3 id="提取分组后的部分数据">提取分组后的部分数据</h3>
<p>在 sql 语句中，运行命令的顺序是：</p>
<ul>
<li>
<p>FROM</p>
</li>
<li>
<p>WHERE</p>
</li>
<li>
<p>GROUP BY</p>
</li>
<li>
<p>HAVING</p>
</li>
<li>
<p>SELECT</p>
</li>
<li>
<p>ORDER BY</p>
</li>
<li>
<p>LIMIT</p>
</li>
</ul>
<p>也就是说，我们无法用 where 条件句来对 <code>GroupBy</code> 的结果进行提取，这个时候就引入了 having 命令（发挥的其实就是 where 命令的作用）</p>
<h2 id="subquery-complex-and-dynamic-queries">subquery（complex and dynamic queries）</h2>
<blockquote>
<p>A subquery is a query nested within another query.</p>
</blockquote>
<p><strong>子查询可以出现在很多地方（where 从句和 select 从句），但无论在哪都需要加’()'包围起来！</strong><br>
<img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../img/SQL_20221010160148.png" alt="SQL_20221010160148"></p>
<h3 id="集合运算">集合运算</h3>
<p>每一个子查询可以看成一个 table，table 与 table 之间除了可以进行常见的算术运算和逻辑运算以外，SQL 还增加了一些 table 间进行比较的运算符：<br>
<img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../md_imgs/SQL/6.png" alt="image"><br>
例如</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">SQL: SELECT player_id, player_name, height FROM player WHERE height &gt; ANY (SELECT height FROM player WHERE team_id = 1002)</span><br></pre></td></tr></table></figure>
<p><code>ANY</code>,<code>ALL</code>可以看做是一个函数(简单来说)</p>
<h2 id="combining-colums-with-joining">Combining Colums with Joining</h2>
<p><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../img/SQL_20221010160243.png" alt="SQL_20221010160243"><br>
join 命令可以用来将数据表联系起来，被联系的数据表既可以是已有的表，也可以是 subquery</p>
<h3 id="inner-join">Inner Join</h3>
<p>这个命令主要用来查询两个表中匹配的信息，可以理解为两个表的交集。<br>
<img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../img/SQL_20221010160303.png" alt="SQL_20221010160303"><br>
The inner join clause is made up of two parts:</p>
<ul>
<li>
<p><code>INNER JOIN</code>, which tells the SQL engine the name of the table you wish to join in your query, and that you wish to use an inner join.</p>
</li>
<li>
<p><code>ON</code>, which tells the SQL engine what columns to use to join the two tables.</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT * FROM facts AS f</span><br><span class="line">INNER JOIN cities AS c ON c.facts_id = f.id</span><br></pre></td></tr></table></figure>
<h3 id="left-join">Left Join</h3>
<blockquote>
<p>A left join includes all the rows that an inner join will select, plus any rows from the first (or left) table that don’t have a match in the second table. We can see this represented as a Venn diagram.</p>
</blockquote>
<p><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../img/SQL_20221010160323.png" alt="SQL_20221010160323"><br>
该命令会把 b 中不匹配的一部分直接置为空值，然后如果需要调用这些不匹配的数据可以使用 where 从句匹配空值，这时用的是 is 判断<br>
<img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../img/SQL_20221010160439.png" alt="SQL_20221010160439"></p>
<h3 id="right-join">RIGHT JOIN</h3>
<p>同时使用多张表时，可能会用到 RIGHT JOIN 从句<br>
<img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../img/SQL_20221010160501.png" alt="SQL_20221010160501"></p>
<h3 id="full-join">FULL JOIN</h3>
<blockquote>
<p>The other join type not supported by SQLite is a full outer join. A full outer join will include all rows from the tables on both sides of the join. We can see a full outer join in the Venn diagram below:</p>
</blockquote>
<p><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../img/SQL_20221010160520.png" alt="SQL_20221010160520"></p>
<h3 id="self-join">Self-join</h3>
<p>Self-join 是将同一张表 join 起来的方法，一般会用做列与列之间有关系的表的查询，而且对这样的 join 一般只有 INNER 和 LEFT 两种方法。以一张既有劳工又有监督者的表格做例子<br>
<img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../md_imgs/SQL/13.png" alt="images.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT e1.first_name ||&#x27; &#x27;|| e1.last_name employee_name,e1.title employee_title,e2.first_name ||&quot; &quot;||e2.last_name supervisor_name,e2.title supervisor_title</span><br><span class="line">FROM employee e1</span><br><span class="line">LEFT JOIN employee e2 on e1.reports_to=e2.employee_id</span><br><span class="line">ORDER BY employee_name</span><br></pre></td></tr></table></figure>
<h2 id="joining-for-many-tables">Joining for many tables</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT [column_names] FROM [table_name_one]</span><br><span class="line">[join_type] JOIN [table_name_two] ON [join_constraint]</span><br><span class="line">[join_type] JOIN [table_name_three] ON [join_constraint];</span><br></pre></td></tr></table></figure>
<p>The SQL engine interprets joins in order, so the first join will be executed, and then the second join will be executed against the result of the first join. Because of this, we can first build our query in steps:</p>
<ul>
<li>
<p>with 0 joins.</p>
</li>
<li>
<p>with 1 join.</p>
</li>
<li>
<p>with 2 joins.</p>
</li>
</ul>
<h2 id="combining-rows-with-union">Combining Rows with UNION</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[select_statement_one]</span><br><span class="line">UNION</span><br><span class="line">[select_statement_two]</span><br></pre></td></tr></table></figure>
<p>SQL 可以通过 UNION 来实现列拼接，然后需要注意的是拼接前后两个<strong>查询</strong>（表格的合并可以借助 select *）同一列的数据类型，int 和 float 是兼容的，但是 int 和 text 是不兼容的。<br>
<img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../img/SQL_20221010160547.png" alt="SQL_20221010160547"></p>
<p><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../md_imgs/SQL/15.png" alt="image.png"></p>
<h1 id="thinking-in-sql">Thinking in SQL</h1>
<ul>
<li>
<p>Think about what data you need in your final output</p>
</li>
<li>
<p>Work out which tables you’ll need to join, and whether you will need to join to a subquery.</p>
<ul>
<li>If you need to join to a subquery, write the subquery first.</li>
</ul>
</li>
<li>
<p>Then start writing your SELECT clause, followed by the join and any other clauses you will need.</p>
</li>
<li>
<p>Don’t be afraid to write your query in steps, running it as you go— for instance you can run your subquery as a ‘stand alone’ query first to make sure it looks like you want before writing the outer query.</p>
</li>
</ul>
<h2 id="philosophy-of-writting-sql">philosophy of writting SQL</h2>
<p>在 sql 中大小写和空格是对查询没有影响的</p>
<ul>
<li>
<p>If a select statement has more than one column, put each on a new line, indented from the select statement.</p>
</li>
<li>
<p>Always capitalize SQL function names and keywords</p>
</li>
<li>
<p>Put each clause of your query on a new line.</p>
</li>
<li>
<p>Use indenting to make subqueries appear logically separate.</p>
</li>
<li>
<p>use of alias names and shortcuts</p>
</li>
<li>
<p>换行符可以随便使用但是不要出现空行</p>
</li>
</ul>
<h3 id="指代一个-subquery">指代一个 subquery</h3>
<blockquote>
<p>Everything in SQL is a table。</p>
</blockquote>
<h4 id="with-临时指代-cte">with 临时指代(CTE)</h4>
<p>子查询嵌套进查询语句中会降低代码的可读性，SQL 提供了 WITH 方法来对子查询进行一个化名（alias）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WITH [alias_name] AS ([subquery])</span><br><span class="line"></span><br><span class="line">SELECT [main_query]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT * FROM</span><br><span class="line">    (</span><br><span class="line">     SELECT</span><br><span class="line">         t.name,</span><br><span class="line">         ar.name artist,</span><br><span class="line">         al.title album_name,</span><br><span class="line">         mt.name media_type,</span><br><span class="line">         g.name genre,</span><br><span class="line">         t.milliseconds length_milliseconds</span><br><span class="line">     FROM track t</span><br><span class="line">     INNER JOIN media_type mt ON mt.media_type_id = t.media_type_id</span><br><span class="line">     INNER JOIN genre g ON g.genre_id = t.genre_id</span><br><span class="line">     INNER JOIN album al ON al.album_id = t.album_id</span><br><span class="line">     INNER JOIN artist ar ON ar.artist_id = al.artist_id</span><br><span class="line">    )</span><br><span class="line">WHERE album_name = &quot;Jagged Little Pill&quot;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WITH</span><br><span class="line">    [alias_name] AS ([subquery]),</span><br><span class="line">    [alias_name_2] AS ([subquery_2]),</span><br><span class="line">    [alias_name_3] AS ([subquery_3])</span><br><span class="line"></span><br><span class="line">SELECT [main_query]</span><br></pre></td></tr></table></figure>
<p>一下子创建多个时每一个是独立的，可以在第二个创建时调用第一个</p>
<h4 id="create-view-永久指代">CREATE VIEW 永久指代</h4>
<p>我们可以理解为 with 命令用来定义一个临时的 subquery，如果想要永久地定义一个 sub（即view)，可以使用下列语句：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE VIEW database.view_name AS</span><br><span class="line">    SELECT * FROM database.table;</span><br></pre></td></tr></table></figure>
<p><strong>为了防止和其他 view 冲突</strong>，必须要在 view_name 前边声明 database 的名称（database_name.view/table_name），在定义的时候使用的任何数据库中的表都要在前边加上 database。如果是在本地使用，则不需要写明 database。<br>
创建的一个 view 可以视作一个 table，且不能被重写。在使用是也要写成 database_name.view_name 的形式。</p>
<h1 id="窗口函数">窗口函数</h1>
<p>窗口函数(Online Anallytical Processing)也是在分组计算的语境下提出的，这点其实与pandas 中的<code>apply</code>函数有点类似——将已有的数据先进行分组然后再以组为单位运用特定的函数来进行操作。不过需要注意的是，与sql中<code>group by</code>的分组聚合功能相比，窗口函数最大的特点是其计算并不会改变数据的行数，或者可以说其返回值和输入的行数保持一致。</p>
<p>一般来说，窗口函数的语法为:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">&lt;</span>窗口函数<span class="operator">&gt;</span> <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> <span class="operator">&lt;</span>用于分组的列名<span class="operator">&gt;</span></span><br><span class="line">                <span class="keyword">order</span> <span class="keyword">by</span> <span class="operator">&lt;</span>用于排序的列名<span class="operator">&gt;</span></span><br><span class="line">                [frame_clause]</span><br><span class="line">                )</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其中<code>frame_clause</code>是以所在列为中心，通过选择固定数或者固定值的行作为一个frame，然后通过窗口函数进行计算，有点类似于pandas中的<code>rolling</code>函数，只不过更为灵活，具体语法可以看<a target="_blank" rel="noopener" href="https://www.sqltutorial.org/sql-window-functions/">文档</a></p>
<p>窗口函数可以视为一个字段，一般跟在<code>select</code>后边实现不同的功能，窗口函数主要分为以下三种:</p>
<ol>
<li><strong>排序窗口函数</strong>，比如 rank(), dense_rank(), row_number()等【排序窗口函数<strong>没有输入值</strong>，一般以order by 后边的内容为排序依据】
<ol>
<li>rank() 1 2 2 4 4 6  (计数排名，<strong>跳过相同的几个</strong>，eg.没有3没有5)</li>
<li>row_number() 1 2 3 4 5 6 (赋予唯一排名)</li>
<li>dense_rank()  1 2 2 3 3 4 (不跳过排名，可以理解为对<strong>类别</strong>进行计数)</li>
</ol>
</li>
<li><strong>聚合窗口函数</strong>，如 sum,avg, count, max, min 等</li>
<li><strong>求值窗口函数</strong>,如first_value(),last_value(),lead(),lag()等，这类函数与聚合函数相比很明显的区别是比较依赖于<code>order by</code>后的内容。<br>
对于窗口函数，有以下几点需要强调：</li>
</ol>
<ul>
<li>窗口函数相当于是一个先分组（<code>partition by</code>）后排序(<code>order by</code>)的操作，所以一般跟在<strong>select</strong>后边,操作上晚于<code>group by</code>(一般情况下不把窗口函数和<code>group by</code>一起用，可以先将窗口函数建立成子查询)</li>
<li>不改变原表的行数，常被用于<strong>动态分析</strong></li>
<li>partition子句原则上可以省略，但是这就失去了窗口函数的意义<br>
窗口函数是实际业务中经常会用的的一种方法，接下来通过一些具体的应用场景来说明窗口函数的作用</li>
</ul>
<h2 id="连续登录问题">连续登录问题</h2>
<p>假设给出一张表log_table，记录了用户的登录信息，包括用户id(uid)，登录时间(in_time),现在需要统计每个用户每天连续登录的天数。这个问题可以用窗口函数来解决，具体的思路如下：</p>
<ol>
<li>对于每个用户来说，假如按照登录时间做升序排序(考虑到一天多次登录的情况，需要使用<code>DENSE_RANK()</code>窗口函数并作去重处理),那么登陆日期与排名之差相同的时间(记为flag_time)即为一个连续登录的时间段。</li>
<li>得到连续登录的时间段后，有两种得到连续登录天数的方法：</li>
</ol>
<ul>
<li>考虑到一个flag_time对应一个连续登录时间段，可以按照uid,flag_time分类后使用<code>ROW_NUMBER()</code>窗口函数得到每个时间段的连续登录天数，注意这种方法要事先对表格对uid,in_time排序，否则可能出现一个连续登录时间段内登录天数排列错误的情况；由此衍生出一种更优的策略，即排序字段使用<code>in_time</code>，然后使用<code>DENSE_RANK()</code>窗口函数得到的排序。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> uid,`in_time`,<span class="built_in">DENSE_RANK</span>() <span class="keyword">over</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> uid,flag_time <span class="keyword">ORDER</span> <span class="keyword">BY</span> `in_time`)<span class="operator">%</span><span class="number">7</span></span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> uid,`in_time`,DATE_SUB(`in_time`,<span class="type">INTERVAL</span> counter <span class="keyword">day</span>) <span class="keyword">as</span> flag_time</span><br><span class="line"><span class="keyword">FROM</span>(</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> uid, <span class="type">DATE</span>(in_time)<span class="keyword">as</span> in_time,<span class="built_in">DENSE_RANK</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> uid <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">DATE</span>(in_time)) <span class="keyword">as</span> counter</span><br><span class="line">            <span class="keyword">FROM</span> tb_user_log</span><br><span class="line">            <span class="keyword">where</span> artical_id <span class="operator">=</span><span class="number">0</span> <span class="keyword">and</span> sign_in<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="type">DATE</span>(in_time) <span class="keyword">BETWEEN</span> <span class="string">&#x27;2021-07-07&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2021-10-31&#x27;</span> </span><br><span class="line">) <span class="keyword">at</span></span><br><span class="line">)ft</span><br></pre></td></tr></table></figure>
<p>上述问题也叫做最大连续问题，假如要求连续七天登录的用户数 ，对于记录了用户(uid)和登录日期(login_date)的表格，可以通过自连接实现:</p>
<ul>
<li>用户连续七天登录的充要条件是存在一个日期，其后有六个不同的日期与这一天的日期之差在0,6之间，从这个角度出发，可以对表格作self-join实现如下目的</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t1.uid,t1.login_date <span class="keyword">as</span> start_date</span><br><span class="line"><span class="keyword">FROM</span> login_table <span class="keyword">as</span> t1 <span class="keyword">JOIN</span> login_table <span class="keyword">as</span> t2 <span class="keyword">on</span> t1.uid<span class="operator">=</span>t2.uid <span class="keyword">and</span> DATEDIFF(t2.login_date,t1.login_date) <span class="keyword">BETWEEN</span> <span class="number">0</span> <span class="keyword">AND</span> <span class="number">6</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> uid,t1.login_date</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> t2.login_date)<span class="operator">=</span><span class="number">7</span></span><br></pre></td></tr></table></figure>
<p>最大登录天数本质上是一个窗口滞后的问题，也可以通过<code>lead()</code>、<code>lag()</code>两个函数实现，这个和panda中的<code>shift</code>函数比较类似，只是因为两个函数都只接受正数所以分开了，<code>lead(col,offset,default_return)</code>函数会取出当前行往下第offset个值。对于七天登录问题，如果<code>offset=6</code>的情况下返回值与当前日期相差6，则说明当天开始未来六天该用户都有登录。</p>
<h1 id="interact-with-a-sqlite-database-in-python">interact with a SQLite database in Python</h1>
<blockquote>
<p>SQLite is a database that doesn’t require a standalone server; <strong>it stores the entire database as a file on disk</strong>. This makes it ideal for working with larger datasets that can fit on disk but not in memory.</p>
</blockquote>
<p>two ways to :</p>
<ul>
<li>
<p>Sqlite Shell</p>
</li>
<li>
<p>sqlite3</p>
</li>
</ul>
<h2 id="sqlite-shell">Sqlite Shell</h2>
<p>sqlite shell 是一个用来和 sqlite 进行交互的命令行窗口，接下来用它来演示如何进行数据库的创建和修改<br>
Sqlite3 shell 写 query 的原则：</p>
<ul>
<li>
<p>要打开 sqlite shell，需要输入’sqlite3+db_file’</p>
</li>
<li>
<p>换行只表示换行含义，当输入’;'表示输入的 query 完毕</p>
</li>
<li>
<p>sqlite 有许多点命令，可以用来进行全局设置的调整，一般情况下查询结果是不显示列名的，可以通过’.headers on’调整</p>
</li>
<li>
<p>可以通过输入’.mode column’来更改输出格式，保证每一行的列宽相等</p>
</li>
<li>
<p>常用的点命令</p>
<ul>
<li>
<p>.help:显示所有点命令和功能</p>
</li>
<li>
<p>.tables:显示当前数据库的列名</p>
</li>
<li>
<p>.shell [command]:执行命令</p>
</li>
<li>
<p>.quit 退出</p>
</li>
</ul>
</li>
</ul>
<ol>
<li>表的创建</li>
</ol>
<p>在 sqlite shell 中，表格的创建借助 CREATE TABLE 命令，格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE [table_name] (</span><br><span class="line">  [column1_name] [column1_type] PRIMARY KEY,</span><br><span class="line">  [column2_name] [column2_type],</span><br><span class="line">  [column3_name] [column3_type],</span><br><span class="line">  [...]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>需要注意的是 sqlite 支持五种（通用）数据类型：</p>
<ul>
<li>
<p>TEXT</p>
</li>
<li>
<p>INTEGER</p>
</li>
<li>
<p>REAL:DOUBLE+FLOAT</p>
</li>
<li>
<p>NULL</p>
</li>
<li>
<p>BLOB：二进制</p>
</li>
</ul>
<p>可以使用点命令’.schema [tb_name]'查看表格图解<br>
<img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../md_imgs/SQL/16.png" alt="image.png"></p>
<ol>
<li>表的删除</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DROP TABLE [table_name];</span><br></pre></td></tr></table></figure>
<h2 id="sqlite3">sqlite3</h2>
<p>sqlite3 是 python 中一个用来处理处理关系型数据库的标准库，把数据文件存储在了普通文件中。该模块是在 DB-API 的基础上建立的，很多地方是一致的。DB-API 的主要函数：</p>
<ul>
<li>connect():连接数据库</li>
</ul>
<blockquote>
<p>When we’re connected to a database, SQLite locks the database file and prevents any other processes from connecting to the database simultaneously. The SQLite team designed the module this way to keep the database lightweight and to avoid the complexity of multiple processes interacting with the same database.</p>
</blockquote>
<ul>
<li>
<p>cursor():创建一个 cursor 对象管理查询，作用</p>
<ul>
<li>
<p>Run a query against the database</p>
</li>
<li>
<p>Parse the results from the database</p>
</li>
<li>
<p>Convert the results to native Python objects</p>
</li>
<li>
<p>Store the results within the Cursor instance as a local variable</p>
</li>
</ul>
</li>
<li>
<p>execute()和 executemany（）:对数据库执行一个或者多个 SQL 命令（The SQLite library actually allows us to skip creating a Cursor altogether by using the execute method within the Connection object itself，SQLite will create a Cursor instance for us under the hood and run our query against the database, allowing us to skip a step.）</p>
</li>
<li>
<p>fetchone()、fetchmany()、fetchmany(n)：Cusor method（ Fetch the full results set as a list of tuples）</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line">con = sqlite3.connect(<span class="string">&#x27;example.db&#x27;</span>)</span><br><span class="line">cur = con.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create table</span></span><br><span class="line">cur.execute(<span class="string">&#x27;&#x27;&#x27;CREATE TABLE stocks</span></span><br><span class="line"><span class="string">               (date text, trans text, symbol text, qty real, price real)&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Insert a row of data</span></span><br><span class="line">cur.execute(<span class="string">&quot;INSERT INTO stocks VALUES (&#x27;2006-01-05&#x27;,&#x27;BUY&#x27;,&#x27;RHAT&#x27;,100,35.14)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Save (commit) the changes</span></span><br><span class="line">con.commit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># We can also close the connection if we are done with it.</span></span><br><span class="line"><span class="comment"># Just be sure any changes have been committed or they will be lost.</span></span><br><span class="line">con.close()</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> cur.execute(<span class="string">&#x27;SELECT * FROM stocks ORDER BY price&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(row)</span><br><span class="line"><span class="comment">#在不使用时，记得关闭打开的游标和连接</span></span><br><span class="line">cur.close()</span><br><span class="line">con.close()</span><br></pre></td></tr></table></figure>
<h1 id="mysql">MySQL</h1>
<p><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../md_imgs/SQL/17.png" alt="image.png"></p>
<h1 id="sqlalchemy">SQLAlchemy</h1>
<p>SQLAlchemy 是 python 中用来消除不同数据库语言差异的一个库，虽然不在标准库当中，但是被广泛认可，使用者众多。<br>
SQLAlchemy 不需要导入驱动程序，初始化的连接字符串会做出分配，例如：<br>
<code>dialect + driver :// user : password @ host : port / dbnam</code></p>
<ul>
<li>
<p>dialect: the type of db</p>
</li>
<li>
<p>driver:特殊驱动程序</p>
</li>
<li>
<p>host/port:数据服务器的位置(只有特定情况下会使用端口号 port)</p>
</li>
<li>
<p>dbname:连接到的数据库名字，可以/开头表示绝对路径</p>
</li>
</ul>
<p><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="../md_imgs/SQL/18.png" alt="image.png"><br>
以内置的 sqlite 为例，省略 host、port 等参数（引擎层）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlalchemy <span class="keyword">as</span> sa</span><br><span class="line">conn=sa.create_engine(<span class="string">&#x27;sqlite:///:memory:&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="sql-表达式语言">SQL 表达式语言</h2>
<p>除了基础的 SQL 表达式语言以外，sqlalchemy 还提供了多种 SQL 操作的函数，这种函数调用能解决不同 sql 语言之间的差异，对于关系型数据库应用是一种中间型方案。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> mysqlx <span class="keyword">import</span> Column</span><br><span class="line"><span class="keyword">import</span> sqlalchemy <span class="keyword">as</span> sa</span><br><span class="line">conn=sa.create_engine(<span class="string">&#x27;sqlite:///Mydb1&#x27;</span>)</span><br><span class="line"><span class="comment">#创建表格</span></span><br><span class="line">meta=sa.MetaData()</span><br><span class="line">Stu_info=sa.Table(<span class="string">&#x27;Stu_info&#x27;</span>,meta,</span><br><span class="line">              sa.Column(<span class="string">&#x27;Student Name&#x27;</span>,sa.String,primary_key=<span class="literal">True</span>),</span><br><span class="line">              sa.Column(<span class="string">&#x27;Student Age&#x27;</span>,sa.INT)</span><br><span class="line">              )</span><br><span class="line">meta.create_all(conn)</span><br><span class="line"><span class="comment">#插入数据</span></span><br><span class="line">conn.execute(Stu_info.insert((<span class="string">&quot;xiaoming&quot;</span>,<span class="number">18</span>)))</span><br><span class="line">conn.execute(Stu_info.insert((<span class="string">&quot;xiaohong&quot;</span>,<span class="number">27</span>)))</span><br><span class="line"><span class="comment">#select all</span></span><br><span class="line">result=conn.execute(Stu_info.select())</span><br><span class="line">rows=result.fetchall()</span><br><span class="line"><span class="built_in">print</span>(rows)</span><br></pre></td></tr></table></figure>
<h2 id="对象关系映射">对象关系映射</h2>
<p>除了通过定义好的 SQL 函数来处理数据库,sqlalchemy 还提供了对象关系映射(ORM)来使用 SQL 表达式语言,隐藏了实际数据库的机制,通过自己定义的对象,ORM 负责处理如何对数据库进行相关处理.有点类似于本土化处理，让操作数据的方式与 python 更加接近！</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlalchemy <span class="keyword">as</span> sa</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"><span class="comment">#连接数据库</span></span><br><span class="line">conn=sa.create_engine(<span class="string">&#x27;sqlite:///Mydb.db&#x27;</span>)</span><br><span class="line">Base=declarative_base()</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stu_info</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    __tablename__=<span class="string">&#x27;stu_info&#x27;</span></span><br><span class="line">    name=sa.Column(<span class="string">&#x27;Student Name&#x27;</span>,sa.String,primary_key=<span class="literal">True</span>)</span><br><span class="line">    age=sa.Column(<span class="string">&#x27;Student Age&#x27;</span>,sa.INT)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,name,age</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.name=name</span><br><span class="line">        self.age=age</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;Stu_info(&#123;&#125;,&#123;&#125;)&gt;&quot;</span>.<span class="built_in">format</span>(self.name,self.age)</span><br><span class="line"><span class="comment">#创建数据库和表单</span></span><br><span class="line">Base.metadata.create_all(conn)</span><br><span class="line">first=Stu_info(<span class="string">&quot;xiaoming&quot;</span>,<span class="number">18</span>)</span><br><span class="line">second=Stu_info(<span class="string">&quot;xiaohong&quot;</span>,<span class="number">23</span>)</span><br><span class="line"><span class="built_in">print</span>(first)</span><br><span class="line"><span class="comment">#将创建的数据写入数据库</span></span><br><span class="line">Session=sa.orm.sessionmaker(bind=conn)</span><br><span class="line">session=Session()</span><br><span class="line">session.add(first)</span><br><span class="line">session.add(second)</span><br><span class="line"><span class="comment">#session.add_all([first,second])</span></span><br><span class="line">session.commit()</span><br></pre></td></tr></table></figure>
<p>三个层级属于 sqlalchemy 不同的用法</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://kobal.top">爱编程的小明</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://kobal.top/SQL/">https://kobal.top/SQL/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://kobal.top" target="_blank">小明的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">数据分析</a><a class="post-meta__tags" href="/tags/SQL/">SQL</a><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></div><div class="post_share"><div class="social-share" data-image="/top_img/10005.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/%E7%BB%9F%E8%AE%A1%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%90%86%E8%AE%BA/" title="统计机器学习理论"><img class="cover" src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="/top_img/10025.webp" onerror="onerror=null;src='https://images.pexels.com/photos/374918/pexels-photo-374918.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=600'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">统计机器学习理论</div></div></a></div><div class="next-post pull-right"><a href="/%E7%BB%BC%E5%90%88%E5%AE%9E%E4%BE%8B/" title="综合实例"><img class="cover" src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="/top_img/10046.webp" onerror="onerror=null;src='https://images.pexels.com/photos/374918/pexels-photo-374918.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=600'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">综合实例</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/Matplotlib/" title="Matplotlib库"><img class="cover" src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="https://matplotlib.org/_static/images/logo2.svg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-01</div><div class="title">Matplotlib库</div></div></a></div><div><a href="/Numpy/" title="Numpy"><img class="cover" src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="/top_img/10027.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-27</div><div class="title">Numpy</div></div></a></div><div><a href="/Pandas/" title="Pandas"><img class="cover" src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="https://camo.githubusercontent.com/981d48e57e23a4907cebc4eb481799b5882595ea978261f22a3e131dcd6ebee6/68747470733a2f2f70616e6461732e7079646174612e6f72672f7374617469632f696d672f70616e6461732e737667" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-02</div><div class="title">Pandas</div></div></a></div><div><a href="/R%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/" title="R基础"><img class="cover" src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="https://www.r-project.org/logo/Rlogo.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-01</div><div class="title">R基础</div></div></a></div><div><a href="/Seaborn%E5%BA%93%E7%AE%80%E4%BB%8B/" title="Seaborn库简介"><img class="cover" src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="https://seaborn.pydata.org/_images/logo-wide-lightbg.svg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-21</div><div class="title">Seaborn库简介</div></div></a></div><div><a href="/pd%E5%AE%9E%E6%88%98/" title="Pd实战"><img class="cover" src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="https://camo.githubusercontent.com/981d48e57e23a4907cebc4eb481799b5882595ea978261f22a3e131dcd6ebee6/68747470733a2f2f70616e6461732e7079646174612e6f72672f7374617469632f696d672f70616e6461732e737667" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-06</div><div class="title">Pd实战</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="/img/avatar.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">爱编程的小明</div><div class="author-info__description">只要不折腾，万般可将就</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">100</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">57</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/kebuAAA"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/kebuAAA" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/2945190789@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/img/wechat.webp" target="_blank" title="欢迎交流"><i class="fa-brands fa-weixin"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">如网页加载较慢请尝试魔法上网，博客图文可能无关可以忽略</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#sql"><span class="toc-number">1.</span> <span class="toc-text">SQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%B9%A6%E5%86%99%E8%A7%84%E5%88%99"><span class="toc-number">2.</span> <span class="toc-text">基本书写规则</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">2.1.</span> <span class="toc-text">表的创建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E7%9A%84%E5%88%A0%E9%99%A4%E5%92%8C%E6%9B%B4%E6%96%B0"><span class="toc-number">2.2.</span> <span class="toc-text">表的删除和更新</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%9A%84%E5%88%A0%E9%99%A4%EF%BC%9A"><span class="toc-number">2.2.1.</span> <span class="toc-text">表的删除：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%9A%84%E4%BF%AE%E6%94%B9-alter-table-%EF%BC%9A"><span class="toc-number">2.2.2.</span> <span class="toc-text">表的修改（ALTER TABLE）：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%9A%84%E6%B8%85%E7%A9%BA"><span class="toc-number">2.2.3.</span> <span class="toc-text">表的清空</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">2.3.</span> <span class="toc-text">插入数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9A%84%E6%9B%B4%E6%96%B0"><span class="toc-number">2.3.1.</span> <span class="toc-text">数据的更新</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="toc-number">3.</span> <span class="toc-text">查询数据</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BF%90%E7%AE%97%E4%B8%8E%E6%AF%94%E8%BE%83"><span class="toc-number">3.1.</span> <span class="toc-text">数据运算与比较</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E4%B8%8E%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97"><span class="toc-number">3.1.1.</span> <span class="toc-text">算术运算与比较运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="toc-number">3.1.2.</span> <span class="toc-text">逻辑运算</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.</span> <span class="toc-text">常用函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E8%AE%A1%E7%AE%97%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.1.</span> <span class="toc-text">数值计算函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.2.</span> <span class="toc-text">文本处理函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D-like-%E5%AD%97%E5%8F%A5"><span class="toc-number">3.2.3.</span> <span class="toc-text">字符串的模糊匹配（LIKE 字句）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%97%E5%88%B0%E6%96%B0%E7%9A%84%E5%88%97"><span class="toc-number">3.3.</span> <span class="toc-text">得到新的列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%BB%84"><span class="toc-number">3.4.</span> <span class="toc-text">分组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E5%8F%96%E5%88%86%E7%BB%84%E5%90%8E%E7%9A%84%E9%83%A8%E5%88%86%E6%95%B0%E6%8D%AE"><span class="toc-number">3.4.1.</span> <span class="toc-text">提取分组后的部分数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#subquery-complex-and-dynamic-queries"><span class="toc-number">3.5.</span> <span class="toc-text">subquery（complex and dynamic queries）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97"><span class="toc-number">3.5.1.</span> <span class="toc-text">集合运算</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#combining-colums-with-joining"><span class="toc-number">3.6.</span> <span class="toc-text">Combining Colums with Joining</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#inner-join"><span class="toc-number">3.6.1.</span> <span class="toc-text">Inner Join</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#left-join"><span class="toc-number">3.6.2.</span> <span class="toc-text">Left Join</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#right-join"><span class="toc-number">3.6.3.</span> <span class="toc-text">RIGHT JOIN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#full-join"><span class="toc-number">3.6.4.</span> <span class="toc-text">FULL JOIN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#self-join"><span class="toc-number">3.6.5.</span> <span class="toc-text">Self-join</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#joining-for-many-tables"><span class="toc-number">3.7.</span> <span class="toc-text">Joining for many tables</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#combining-rows-with-union"><span class="toc-number">3.8.</span> <span class="toc-text">Combining Rows with UNION</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#thinking-in-sql"><span class="toc-number">4.</span> <span class="toc-text">Thinking in SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#philosophy-of-writting-sql"><span class="toc-number">4.1.</span> <span class="toc-text">philosophy of writting SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E4%BB%A3%E4%B8%80%E4%B8%AA-subquery"><span class="toc-number">4.1.1.</span> <span class="toc-text">指代一个 subquery</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#with-%E4%B8%B4%E6%97%B6%E6%8C%87%E4%BB%A3-cte"><span class="toc-number">4.1.1.1.</span> <span class="toc-text">with 临时指代(CTE)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#create-view-%E6%B0%B8%E4%B9%85%E6%8C%87%E4%BB%A3"><span class="toc-number">4.1.1.2.</span> <span class="toc-text">CREATE VIEW 永久指代</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">窗口函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E7%BB%AD%E7%99%BB%E5%BD%95%E9%97%AE%E9%A2%98"><span class="toc-number">5.1.</span> <span class="toc-text">连续登录问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#interact-with-a-sqlite-database-in-python"><span class="toc-number">6.</span> <span class="toc-text">interact with a SQLite database in Python</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sqlite-shell"><span class="toc-number">6.1.</span> <span class="toc-text">Sqlite Shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sqlite3"><span class="toc-number">6.2.</span> <span class="toc-text">sqlite3</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mysql"><span class="toc-number">7.</span> <span class="toc-text">MySQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sqlalchemy"><span class="toc-number">8.</span> <span class="toc-text">SQLAlchemy</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sql-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%AD%E8%A8%80"><span class="toc-number">8.1.</span> <span class="toc-text">SQL 表达式语言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%85%B3%E7%B3%BB%E6%98%A0%E5%B0%84"><span class="toc-number">8.2.</span> <span class="toc-text">对象关系映射</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Lasso%E5%9B%9E%E5%BD%92/" title="Lasso回归"><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="/top_img/10042.webp" onerror="this.onerror=null;this.src='https://images.pexels.com/photos/374918/pexels-photo-374918.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=600'" alt="Lasso回归"/></a><div class="content"><a class="title" href="/Lasso%E5%9B%9E%E5%BD%92/" title="Lasso回归">Lasso回归</a><time datetime="2023-11-14T16:00:00.000Z" title="更新于 2023-11-15 00:00:00">2023-11-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E5%B2%AD%E5%9B%9E%E5%BD%92/" title="岭回归"><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/岭回归_20231109082818.png" onerror="this.onerror=null;this.src='https://images.pexels.com/photos/374918/pexels-photo-374918.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=600'" alt="岭回归"/></a><div class="content"><a class="title" href="/%E5%B2%AD%E5%9B%9E%E5%BD%92/" title="岭回归">岭回归</a><time datetime="2023-11-07T16:00:00.000Z" title="更新于 2023-11-08 00:00:00">2023-11-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E4%BC%98%E9%9B%85%E8%AE%BA%E6%96%87%E6%8E%92%E7%89%88/" title="优雅论文排版"><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/优雅论文排版_20230921093206.png" onerror="this.onerror=null;this.src='https://images.pexels.com/photos/374918/pexels-photo-374918.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=600'" alt="优雅论文排版"/></a><div class="content"><a class="title" href="/%E4%BC%98%E9%9B%85%E8%AE%BA%E6%96%87%E6%8E%92%E7%89%88/" title="优雅论文排版">优雅论文排版</a><time datetime="2023-09-20T16:00:00.000Z" title="更新于 2023-09-21 00:00:00">2023-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E5%A4%9A%E5%85%83%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90/" title="多元统计分析"><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/多元统计分析_多元正态曲线.png" onerror="this.onerror=null;this.src='https://images.pexels.com/photos/374918/pexels-photo-374918.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=600'" alt="多元统计分析"/></a><div class="content"><a class="title" href="/%E5%A4%9A%E5%85%83%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90/" title="多元统计分析">多元统计分析</a><time datetime="2023-06-16T02:22:54.000Z" title="更新于 2023-06-16 10:22:54">2023-06-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Hypothesis%20testing/" title="假设检验"><img src= "https://gcore.jsdelivr.net/gh/kebuAAA/Picloud@main/img/loading.gif" data-lazy-src="/top_img/10042.webp" onerror="this.onerror=null;this.src='https://images.pexels.com/photos/374918/pexels-photo-374918.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=600'" alt="假设检验"/></a><div class="content"><a class="title" href="/Hypothesis%20testing/" title="假设检验">假设检验</a><time datetime="2023-05-09T02:34:00.000Z" title="更新于 2023-05-09 10:34:00">2023-05-09</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="footer_custom_text"><div id="runtime"></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.kobal.top/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.kobal.top/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))

    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(init,0)
    else getScript('https://cdn.staticfile.org/twikoo/1.6.22/twikoo.all.min.js').then(init)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script src="/Scripts/js/beijing.js"></script><script src="/Scripts/js/foot_style.js"></script><script src="/Scripts/js/fireworks.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.bootcdn.net/ajax/libs/butterfly-extsrc/1.1.3/fireworks.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '0.5s');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/wow/1.1.2/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --></body></html>