<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Pandas | 小明的博客</title><meta name="keywords" content="数据分析,Python库,Pandas"><meta name="author" content="可不"><meta name="copyright" content="可不"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#e68ab8"><meta name="description" content="速查表   中文.pdf 简介 Pandas 是 Python 的核心数据分析支持库，提供了快速、灵活、明确的数据结构，旨在简单、直观地处理关系型、标记型数据。Pandas 的目标是成为 Python 数据分析实践与实战的必备高级工具，其长远目标是成为最强大、最灵活、可以支持任何语言的开源数据分析工具。经过多年不懈的努力，Pandas 离这个目标已经越来越近了。  虽然 pandas 采用了大量的">
<meta property="og:type" content="article">
<meta property="og:title" content="Pandas">
<meta property="og:url" content="https://kebuaaa.github.io/Pandas/index.html">
<meta property="og:site_name" content="小明的博客">
<meta property="og:description" content="速查表   中文.pdf 简介 Pandas 是 Python 的核心数据分析支持库，提供了快速、灵活、明确的数据结构，旨在简单、直观地处理关系型、标记型数据。Pandas 的目标是成为 Python 数据分析实践与实战的必备高级工具，其长远目标是成为最强大、最灵活、可以支持任何语言的开源数据分析工具。经过多年不懈的努力，Pandas 离这个目标已经越来越近了。  虽然 pandas 采用了大量的">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://images.pexels.com/photos/159866/books-book-pages-read-literature-159866.jpeg?auto=compress&cs=tinysrgb&w=600">
<meta property="article:published_time" content="2022-03-26T02:34:00.000Z">
<meta property="article:modified_time" content="2022-07-15T04:03:12.460Z">
<meta property="article:author" content="可不">
<meta property="article:tag" content="数据分析">
<meta property="article:tag" content="Python库">
<meta property="article:tag" content="Pandas">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://images.pexels.com/photos/159866/books-book-pages-read-literature-159866.jpeg?auto=compress&cs=tinysrgb&w=600"><link rel="shortcut icon" href="../img/favicon.png"><link rel="canonical" href="https://kebuaaa.github.io/Pandas/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="../css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Pandas',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2022-07-15 12:03:12'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#e68ab8')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><style>#article-container.post-content h1:before, h2:before, h3:before, h4:before, h5:before, h6:before { -webkit-animation: avatar_turn_around 1s linear infinite; -moz-animation: avatar_turn_around 1s linear infinite; -o-animation: avatar_turn_around 1s linear infinite; -ms-animation: avatar_turn_around 1s linear infinite; animation: avatar_turn_around 1s linear infinite; }</style><link rel="stylesheet" href="/Scripts/css/touming.css"><link rel="stylesheet" href="/Scripts/css/font.css"><meta name="generator" content="Hexo 5.4.2"><link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="../img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="../archives/"><div class="headline">文章</div><div class="length-num">95</div></a><a href="../tags/"><div class="headline">标签</div><div class="length-num">62</div></a><a href="../categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="../index.html"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="../archives/"><i class="fa-fw fas fa-archive"></i><span> 存档</span></a></div><div class="menus_item"><a class="site-page" href="../tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="../categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="../link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="../about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="../wallpaper/"><i class="fa-fw fas fa-image fa-fw"></i><span> 相册</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://images.pexels.com/photos/159866/books-book-pages-read-literature-159866.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=600')"><nav id="nav"><span id="blog_name"><a id="site-name" href="../index.html">小明的博客</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="../index.html"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="../archives/"><i class="fa-fw fas fa-archive"></i><span> 存档</span></a></div><div class="menus_item"><a class="site-page" href="../tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="../categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="../link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="../about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="../wallpaper/"><i class="fa-fw fas fa-image fa-fw"></i><span> 相册</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Pandas</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-03-26T02:34:00.000Z" title="发表于 2022-03-26 10:34:00">2022-03-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-07-15T04:03:12.460Z" title="更新于 2022-07-15 12:03:12">2022-07-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="../categories/Python/">Python</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="../categories/Python/Python%E5%BA%93/">Python库</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Pandas"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>速查表</h1>
<p><img src="../md_imgs/Pandas/0.png" alt="687474703a2f2f7374617469632e7a7962756c756f2e636f6d2f5465616d2f3169333372753069793634746f7236766239646170356e782f70642e706e67.png"><br>
<img src="../md_imgs/Pandas/1.bmp" alt="Python数据科学速查表 - Pandas 进阶.bmp"><br>
<a href="../md_imgs/Pandas/%E4%B8%AD%E6%96%87.pdf">中文.pdf</a></p>
<h1>简介</h1>
<p><strong>Pandas</strong> 是 Python 的核心数据分析支持库，提供了快速、灵活、明确的数据结构，旨在简单、直观地处理关系型、标记型数据。Pandas 的目标是成为 Python 数据分析实践与实战的必备高级工具，其长远目标是成为<strong>最强大、最灵活、可以支持任何语言的开源数据分析工具</strong>。经过多年不懈的努力，Pandas 离这个目标已经越来越近了。</p>
<blockquote>
<p>虽然 pandas 采用了大量的 NumPy 编码风格，但二者最大的不同是 pandas 是专门为处理表格和混杂数据设计的。而 NumPy 更适合处理统一的数值数组数据。</p>
</blockquote>
<h1>Pandas 数据结构</h1>
<p>DataFrame 是 Pandas 最常用也是非常重要的一个对象，它是一个二维的数据结构，数据以行和列的表格方式排列。index+value+column<br>
Series 是一个一维数据结构，包括 index 和 value。</p>
<h2 id="series">Series</h2>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"xiao ming"</span><span class="token punctuation">,</span> <span class="token string">"xiao hong"</span><span class="token punctuation">,</span> <span class="token string">"xiao lan"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>index
data<span class="token punctuation">.</span>values
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="dataframe">DataFrame</h2>
<h3 id="属性：">属性：</h3>
<ul>
<li><strong>info:基本信息</strong></li>
<li>columns:列名</li>
<li>size</li>
<li>shape</li>
<li>len：查看某列的行数</li>
<li>count:查看某列的有效值（非空）的个数</li>
</ul>
<p><img src="../md_imgs/Pandas/2.jpg" alt="66.jpg"></p>
<h3 id="方法">方法</h3>
<ul>
<li>head():</li>
<li>tail():</li>
</ul>
<h3 id="创建-dataframe">创建 DataFrame</h3>
<p>创建 DataFrame 的方式有很多种，一般比较常用的是利用一个字典或者数组来进行创建</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'Height'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1.7</span><span class="token punctuation">,</span> <span class="token number">1.8</span><span class="token punctuation">,</span> <span class="token number">1.9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                     <span class="token string">'Weight'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                    index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"xiaoming"</span><span class="token punctuation">,</span> <span class="token string">"xiaohong"</span><span class="token punctuation">,</span> <span class="token string">"xiaowang"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
arr <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># print(arr)</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>arr<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"Height"</span><span class="token punctuation">,</span> <span class="token string">'Weight'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span>
                    <span class="token string">"xiao ming"</span><span class="token punctuation">,</span> <span class="token string">'xiao hong'</span><span class="token punctuation">,</span> <span class="token string">'xiao zhang'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment">#设置总行名和总列名</span>
data<span class="token punctuation">.</span>index<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'students'</span>
data<span class="token punctuation">.</span>columns<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'body size'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>也可以通过字典嵌套的方式把 index 揉进去,(不建议，每一个嵌套的字典里要写行索引)<br>
<img src="../md_imgs/Pandas/3.png" alt="image.png"></p>
<h2 id="标签重命名">标签重命名</h2>
<ul>
<li>pd/se 创建时可以指定行列名字</li>
<li><a target="_blank" rel="noopener" href="http://df.index.name">df.index.name</a> 属性可以用来修改标签名称</li>
<li>df.rename()方法进行修改（支持传入函数</li>
</ul>
<h2 id="多级索引">多级索引</h2>
<p>多级索引提供了一种以一个较低维度的形式访问高维数据的方法，每次一个维度的索引都相当于对原数据进行一次降维。多级索引建立与单个索引相似，只需将每一级各个值对应的索引名称传给 index 参数即可，每一级的索引单独组成一个列表，传入 index 的参数应为列表的嵌套。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'Grade One'</span><span class="token punctuation">,</span> <span class="token string">'Grade Two'</span><span class="token punctuation">,</span> <span class="token string">'Grade Two'</span><span class="token punctuation">,</span> <span class="token string">'Grade Two'</span><span class="token punctuation">,</span>
     <span class="token string">'Grade Three'</span><span class="token punctuation">,</span> <span class="token string">'Grade Three'</span><span class="token punctuation">,</span> <span class="token string">'Grade Three'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token string">'xiaohong'</span><span class="token punctuation">,</span> <span class="token string">'xiaowang'</span><span class="token punctuation">,</span>
     <span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token string">'xiaohong'</span><span class="token punctuation">,</span> <span class="token string">'xiaowang'</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
    name<span class="token operator">=</span><span class="token string">'Student_ID'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>index<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">'xiaoming'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#在创建df时规定列名与行名的一种方法</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    index<span class="token operator">=</span>pd<span class="token punctuation">.</span>Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Ohio'</span><span class="token punctuation">,</span> <span class="token string">'Colorado'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    columns<span class="token operator">=</span>pd<span class="token punctuation">.</span>Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    name<span class="token operator">=</span><span class="token string">'number'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对于 df 来说，列标签也支持多级索引，最通俗的创建方式是：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token operator">=</span>pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data<span class="token punctuation">,</span>index<span class="token punctuation">,</span>column<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>index<span class="token punctuation">.</span>name<span class="token operator">=</span>
df<span class="token punctuation">.</span>columns<span class="token punctuation">.</span>name<span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>具体传入参数根据列标签和行标签进行适当调整即可（列表或者列表嵌套）。同样的对行的索引方式也支持对列使用。</p>
<h3 id="行列索引的互相转化">行列索引的互相转化</h3>
<h4 id="series-df">Series/df</h4>
<p>另外对于二级索引的 series，还可以借助 series.unstack()方法将二级索引拆成一个 dataframe，同样的也可以借助 stack 方法将一个 df 转化为一个 series（inverse operation)。pd 的多级索引设置成了单独的对象（MultiIndex）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'Grade One'</span><span class="token punctuation">,</span> <span class="token string">'Grade Two'</span><span class="token punctuation">,</span> <span class="token string">'Grade Two'</span><span class="token punctuation">,</span> <span class="token string">'Grade Two'</span><span class="token punctuation">,</span>
     <span class="token string">'Grade Three'</span><span class="token punctuation">,</span> <span class="token string">'Grade Three'</span><span class="token punctuation">,</span> <span class="token string">'Grade Three'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token string">'xiaohong'</span><span class="token punctuation">,</span> <span class="token string">'xiaowang'</span><span class="token punctuation">,</span>
     <span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token string">'xiaohong'</span><span class="token punctuation">,</span> <span class="token string">'xiaowang'</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
    name<span class="token operator">=</span><span class="token string">'Student_ID'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>index<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">'xiaoming'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#使用unstack对data进行重构</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="df-的重置索引">df 的重置索引</h4>
<p>一般来说，我们很少使用 df 的多级列标签，更多的情况是将列标签转化为行标签，这时就可以借助 df.set_index 方法：</p>
<ul>
<li>drop:Bool,决定将列标签设置为行标签时原来的列标签是否保留</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">frame <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token string">'c'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span>
                            <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token string">'d'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
frame
frame2 <span class="token operator">=</span> frame<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
frame2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>与该操作进行相反作用的函数是<code>df.reset_index</code><br>
<code>frame2.reset_index()</code></p>
<h4 id="multiindex-创建">MultiIndex 创建</h4>
<p>可以利用 pd 的一些方法来创建一个多级索引对象，可以作为参数 index 的传入值：</p>
<ul>
<li><code>pd.MultiIndex.from_arrays</code>：创建方式类似于 zip 函数、</li>
<li><code>pd.MultiIndex.from_product</code>:有点像 for 循环式的嵌套</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_arrays<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Ohio'</span><span class="token punctuation">,</span> <span class="token string">'Ohio'</span><span class="token punctuation">,</span> <span class="token string">'Colorado'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Green'</span><span class="token punctuation">,</span> <span class="token string">'Red'</span><span class="token punctuation">,</span> <span class="token string">'Green'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                       names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'state'</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_product<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Ohio'</span><span class="token punctuation">,</span> <span class="token string">'Ohio'</span><span class="token punctuation">,</span> <span class="token string">'Colorado'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Green'</span><span class="token punctuation">,</span> <span class="token string">'Red'</span><span class="token punctuation">,</span> <span class="token string">'Green'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                       names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'state'</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="reordering-and-sorting-levels">Reordering and Sorting levels</h4>
<p>多级标签下的每一级算一个 level，pd 提供了对 level 的重新排列和对任一 level 的排序</p>
<ul>
<li>df/series.swaplevel():传递参数为两个 level 的数字或者是名称</li>
<li>df/series.sort_index(level=):按照任意 level 排序</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">data <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'Grade One'</span><span class="token punctuation">,</span> <span class="token string">'Grade Two'</span><span class="token punctuation">,</span> <span class="token string">'Grade Two'</span><span class="token punctuation">,</span> <span class="token string">'Grade Two'</span><span class="token punctuation">,</span>
     <span class="token string">'Grade Three'</span><span class="token punctuation">,</span> <span class="token string">'Grade Three'</span><span class="token punctuation">,</span> <span class="token string">'Grade Three'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token string">'xiaohong'</span><span class="token punctuation">,</span> <span class="token string">'xiaowang'</span><span class="token punctuation">,</span>
     <span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token string">'xiaohong'</span><span class="token punctuation">,</span> <span class="token string">'xiaowang'</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
    name<span class="token operator">=</span><span class="token string">'Student_ID'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>index<span class="token punctuation">)</span>
data<span class="token punctuation">.</span>index<span class="token punctuation">.</span>names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Grade'</span><span class="token punctuation">,</span><span class="token string">'Stu_Name'</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>swaplevel<span class="token punctuation">(</span><span class="token string">'Stu_Name'</span><span class="token punctuation">,</span><span class="token string">'Grade'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span>level<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>除了 sort_index,还要很多其他函数也支持按照某一个 level 进行函数操作，只需要在原来函数的基础上传入一个 level 参数即可(df.sum)。</p>
<h3 id="访问-dataframe">访问 DataFrame</h3>
<h4 id="使用字典方式访问-dataframe">使用字典方式访问 DataFrame。</h4>
<ul>
<li>访问单列：DataFrame[‘column1_name’]，DataFrame.column1_name（这种索引方式要保证列名合法）</li>
<li>访问多列：DataFrame[[‘column1_name’,‘colunmn2_name’]]</li>
<li>访问单列多行：DataFrame[‘column1_name’][m:n]</li>
<li>访问多列多行：DataFrame[[‘column1_name’,‘colunmn2_name’]][m:n]</li>
</ul>
<h4 id="使用属性方式访问">使用属性方式访问</h4>
<ul>
<li>单列:DataFrame.column1_name</li>
<li>单列多行:DataFrame.column1_name[m:n]</li>
</ul>
<h4 id="访问行的特殊方法">访问行的特殊方法</h4>
<ul>
<li>访问 m 行到 n 行：DataFrame[:][m:n]</li>
<li>DataFrame.head/tail()：访问前/后五行</li>
</ul>
<h4 id="整数标签的特殊情况">整数标签的特殊情况</h4>
<p>为了防止计算机不知道用户输入的索引是基于位置还是基于标签的，pd 整数标签的索引是基于标签的，也就是说我们不能像列表一样使用 DataFrame[-1]进行访问（仅针对整数作为索引的情况）</p>
<h4 id="切片访问方法">切片访问方法</h4>
<p><strong>DataFrame.loc[]访问</strong><br>
访问时主要采用[行索引或者条件,‘column1_name’]的方式对 DataFrame 进行切片，对行的指定要使用索引或者条件，对列的索引必须使用列名称，如果有多列，则还需要借助[]将列名称括起来。使用 loc 传入的行索引名称如果为一个区间，则前后均为闭区间</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#条件表达式切片用法</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'条件表达式使用字典方式，xy123中x&lt;5的x为：\n'</span><span class="token punctuation">,</span>
     xy123<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>xy123<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">,</span>
     <span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#条件表达式使用字典方式</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'条件表达式使用属性方式，xy123中x>=8的x, y1为：\n'</span><span class="token punctuation">,</span>
     xy123<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>xy123<span class="token punctuation">.</span>x<span class="token operator">>=</span><span class="token number">8</span><span class="token punctuation">,</span>
     <span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">,</span><span class="token string">'y1'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#条件表达式使用属性方式</span>
<span class="token comment">#df.loc[(df.Age>10) &amp; (df.Age&lt;50)]</span>
<span class="token comment">#并列条件记得加括号，不然会报错！！！</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要注意的是 loc 函数的第一个参数不能直接传入整数，可以考虑送个列表进去<br>
<img src="../md_imgs/Pandas/4.png" alt="image.png"><br>
<img src="../md_imgs/Pandas/5.png" alt="image.png"></p>
<p><strong>DataFrame.iloc[]访问</strong><br>
使用方法与 loc 相似，主要区别是该函数在使用时对列的索引可以用列索引号。使用 iloc 传入的行索引位置或列索引位置为区间时，则为前闭后开区间</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#例3-46，iloc条件切片</span>
<span class="token comment">#iloc内部传入表达式，进行条件切片，需使用.values属性</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'条件表达式使用字典方式，xy123中x&lt;1的第1,3列数据为：\n'</span><span class="token punctuation">,</span>
     xy123<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">(</span>xy123<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#条件表达式使用字典方式</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>除了上述两种方法外，切片访问还可以使用 <code>DataFrame.ix[]</code> 方法进行切片，该方法可以看成是上述切片访问方法的结合。</p>
<p><img src="../md_imgs/Pandas/6.png" alt="image.png"><br>
<img src="../md_imgs/Pandas/7.png" alt="image.png"></p>
<h3 id="更改-dataframe-中的数据">更改 DataFrame 中的数据</h3>
<p><strong>更改值</strong></p>
<ol>
<li>更改值可以借助访问 DataFrame 的方法对值进行修改。</li>
<li>也可以通过建立一个 Series 通过赋值运算把两个中索引一致的位置进行修改<br>
<img src="../md_imgs/Pandas/8.png" alt="image.png"></li>
</ol>
<p><strong>添加或者删除行/列</strong></p>
<ul>
<li>添加行或者列可以通过直接赋值的方法进行修改</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">xy123<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>xy123<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'x'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token comment">#更改符合条件的记录的值</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>删除行或者列需要借助 drop 函数（要调整 inplace 参数，感觉这个函数主要是用来不显示某些列的）。删除列也可以用 del 函数</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">DataFrame<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>labels<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
index<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>columns<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>level<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span>Flase<span class="token punctuation">,</span>errors<span class="token operator">=</span><span class="token string">'raise'</span><span class="token punctuation">)</span>
<span class="token comment">#labels接收单个列名或者多个列名的列表或者列的索引或者行索引。</span>
<span class="token comment">#inplace表示是否在原DataFrame上进行操作</span>
<span class="token comment">#axis表示删除的行还是列，默认是0即删除行</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="sorting-and-ranking">Sorting and Ranking</h3>
<ul>
<li>df.sort_index(axis=1,ascending=False)</li>
<li>df.sort_values(by=[‘column_name1’,‘column_name2’])</li>
</ul>
<p>排名使用 rank 方法，默认是通过取排名的平均值来处理排名相同的问题<br>
<code>df.rank(axis=,ascending=,method=)</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
ser <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ser<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ser<span class="token punctuation">.</span>rank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 0    4.5</span>
<span class="token comment"># 1    4.5</span>
<span class="token comment"># 2    6.0</span>
<span class="token comment"># 3    2.0</span>
<span class="token comment"># 4    1.0</span>
<span class="token comment"># 5    3.0</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../md_imgs/Pandas/9.png" alt="image.png"></p>
<h3 id="transposing">Transposing</h3>
<p>借鉴 NumPy，可以通过 DataFrame.T 实现行列互换。</p>
<h2 id="index-object">Index object</h2>
<p>pd 的 Index 对象是用来作为保存轴标签的，而且是不可以被改写的！<br>
一些方法：<br>
<img src="../md_imgs/Pandas/10.png" alt="image.png"></p>
<h3 id="reindex">Reindex</h3>
<p>pd 一个重要的方法是 reindex（）,可以用来重新定义行/列索引的顺序：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'Height'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1.7</span><span class="token punctuation">,</span> <span class="token number">1.8</span><span class="token punctuation">,</span> <span class="token number">1.9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                     <span class="token string">'Weight'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                    index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"xiaoming"</span><span class="token punctuation">,</span> <span class="token string">"xiaohong"</span><span class="token punctuation">,</span> <span class="token string">"xiaowang"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>reindex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"xiaowang"</span><span class="token punctuation">,</span><span class="token string">"xiaoming"</span><span class="token punctuation">,</span><span class="token string">"xiaozhang"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对于数值类索引，在进行 reindex 时还可以进行缺失值的填充，一个方法是’ffill’(“forward-fills”)，实现对缺失索引的前向填充：<br>
<img src="../md_imgs/Pandas/11.png" alt="image.png"></p>
<p><img src="../md_imgs/Pandas/12.png" alt="image.png"></p>
<h4 id="重复标签下的轴索引">重复标签下的轴索引</h4>
<p>对重复标签的索引的返回值会是一个 Series，这会使得我们的代码变得复杂</p>
<h2 id="查找特定值">查找特定值</h2>
<ul>
<li>df/ser.isin（list）:返回布尔值</li>
<li>pd.index(list).get_indexer(to_match):根据 to_match 的情况返回一个对 list 的<strong>索引</strong>，值为 list 的索引值</li>
<li><img src="../md_imgs/Pandas/13.png" alt="image.png"></li>
</ul>
<h1>基本用法</h1>
<h2 id="pandas-读写文件">Pandas 读写文件</h2>
<p>Pd 提供了许多读写结构化数据的为 df 的函数：<br>
<img src="../md_imgs/Pandas/14.png" alt="image.png"><br>
<img src="../md_imgs/Pandas/15.png" alt="image.png"></p>
<h3 id="读写文本文件">读写文本文件</h3>
<p>pandas 读写文本文件时需要借助<code>pandas.read_table()</code>或者<code>pandas.read_csv()</code>函数</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pandas<span class="token punctuation">.</span>read_table<span class="token punctuation">(</span>filepath_or_buffer<span class="token punctuation">,</span> sep<span class="token operator">=</span>’\t’<span class="token punctuation">,</span>
header<span class="token operator">=</span>’infer’<span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> engine<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> nrows<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token comment">#函数在使用时路径位置亦可填写URL</span>
loaded_csv<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_table<span class="token punctuation">(</span>path<span class="token operator">+</span><span class="token string">'data/xy123.csv'</span><span class="token punctuation">,</span>
      sep <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">'gbk'</span><span class="token punctuation">)</span><span class="token comment">#读取csv文本文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../md_imgs/Pandas/16.png" alt="image.png"><br>
<img src="../md_imgs/Pandas/17.png" alt="image.png"></p>
<ul>
<li>chunksize 参数，设置读取数据上限，在文件较大时可能会需要使用</li>
</ul>
<p>pandas 将 DataFrame 保存为.csv 的文本文件时需要利用 <code>DataFrame.to_csv()</code> 函数。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">DataFrame<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>path_or_buf<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> sep<span class="token operator">=</span>’<span class="token punctuation">,</span>’<span class="token punctuation">,</span> na_rep<span class="token operator">=</span>”<span class="token punctuation">,</span>
columns<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>index_label<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>mode<span class="token operator">=</span>’w’<span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token comment">#记得先借助pandas.DataFrame()把数据转换成数据帧DataFrame</span>
df<span class="token operator">=</span>pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'x'</span><span class="token punctuation">:</span>x<span class="token punctuation">,</span><span class="token string">'y1'</span><span class="token punctuation">:</span>y1<span class="token punctuation">,</span><span class="token string">'y2'</span><span class="token punctuation">:</span>y2<span class="token punctuation">,</span><span class="token string">'y'</span><span class="token punctuation">:</span>y3<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">#保存时记得指明元素的分隔符</span>
df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>path<span class="token operator">+</span><span class="token string">'data/xy123.csv'</span><span class="token punctuation">,</span>sep <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">,</span>index <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment">#保存为csv文本文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>参数说明<br>
<img src="../md_imgs/Pandas/18.png" alt="image.png"></li>
</ul>
<p>对于单一分割符的 csv 文件也可以使用 python 内置的 csv 模块，要使用它需要把打开的文件 fp 传到 csv.reader()中（返回可迭代对象）。更重要的是这个库提供了一种方法让我们对读取 csv 的分割符进行自定义（通过定义子类传入 reader 方法即可）：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">my_dialect</span><span class="token punctuation">(</span>csv<span class="token punctuation">.</span>Dialect<span class="token punctuation">)</span><span class="token punctuation">:</span>
    lineterminator <span class="token operator">=</span> <span class="token string">'\n'</span>
    delimiter <span class="token operator">=</span> <span class="token string">';'</span>
    quotechar <span class="token operator">=</span> <span class="token string">'"'</span>
    quoting <span class="token operator">=</span> csv<span class="token punctuation">.</span>QUOTE_MINIMAL
reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">,</span> dialect<span class="token operator">=</span>my_dialect<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../md_imgs/Pandas/19.png" alt="image.png"><br>
<img src="../md_imgs/Pandas/20.png" alt="image.png"><br>
对 csv 文件进行写入也可以利用 csv.writer 规定写入的格式：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'mydata.csv'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>f<span class="token punctuation">,</span> dialect<span class="token operator">=</span>my_dialect<span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token string">'9'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="读写-excel-文件">读写 Excel 文件</h3>
<p>与读取文本文件类似，在访问 Excel 文件时，我们借助 <code>pandas.read_excel（）</code> 来读取文件，借助<code>DataFrame.to_excel()</code>来保存 Excel 文件。与访问文本文件不同的是，这两个函数都有一个 sheet_name 参数用来表示读取的表的名称或者保存的表的名称。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#读取一个文件里的多张表时这样可以增加读取速度</span>
xlsx <span class="token operator">=</span> pd<span class="token punctuation">.</span>ExcelFile<span class="token punctuation">(</span><span class="token string">'examples/ex1.xlsx'</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span>xlsx<span class="token punctuation">,</span> <span class="token string">'Sheet1'</span><span class="token punctuation">)</span>
writer <span class="token operator">=</span> pd<span class="token punctuation">.</span>ExcelWriter<span class="token punctuation">(</span><span class="token string">'examples/ex2.xlsx'</span><span class="token punctuation">)</span>
frame<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>writer<span class="token punctuation">,</span> <span class="token string">'Sheet1'</span><span class="token punctuation">)</span>
writer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#frame.to_excel('examples/ex2.xlsx')</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="读写二进制文件">读写二进制文件</h3>
<p>存储为二进制文件的一个最快方法是使用 python 内置的 pickle，pd 对象都有一个<code>to_pickle()</code>方法将数据以 pickle 的格式写入磁盘。读取时利用<code>read_pickle()</code>方法，但是需要注意的是 pickle 文件不能长期保存（大概是因为翻译规则会随着 library 的变化经常更改）<br>
pd 有两种支持数据存为二进制的格式：HDF5 和 MessagePack</p>
<h4 id="hdf5">HDF5</h4>
<p>HDF5 常用来存储数组数据，这种格式本身是一个 C 的库，但是提供了 matlab、Python 等借口。</p>
<ul>
<li>多种压缩模式，存储高效，但不适合放在内存中</li>
<li>非数据库，适合于一次写入多次读取的数据集（同时写入多个容易崩溃）</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">frame <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
store <span class="token operator">=</span> pd<span class="token punctuation">.</span>HDFStore<span class="token punctuation">(</span><span class="token string">'mydata.h5'</span><span class="token punctuation">)</span><span class="token comment">#创建对象</span>
<span class="token comment">#dict-like API in PY</span>
store<span class="token punctuation">[</span><span class="token string">'obj1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> frame
store<span class="token punctuation">[</span><span class="token string">'obj1_col'</span><span class="token punctuation">]</span> <span class="token operator">=</span> frame<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span>
store
store<span class="token punctuation">[</span><span class="token string">'obj1'</span><span class="token punctuation">]</span>
store<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'obj2'</span><span class="token punctuation">,</span> frame<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'table'</span><span class="token punctuation">)</span>
<span class="token comment">#相当于赋值操作不过允许更加多元的存储格式设定</span>
store<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'obj2'</span><span class="token punctuation">,</span> where<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'index >= 10 and index &lt;= 15'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
store<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
frame<span class="token punctuation">.</span>to_hdf<span class="token punctuation">(</span><span class="token string">'mydata.h5'</span><span class="token punctuation">,</span> <span class="token string">'obj3'</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'table'</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>read_hdf<span class="token punctuation">(</span><span class="token string">'mydata.h5'</span><span class="token punctuation">,</span> <span class="token string">'obj3'</span><span class="token punctuation">,</span> where<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'index &lt; 5'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="interacting-with-databases">Interacting with Databases</h3>
<p>pd 提供了简便获取数据库数据的方法</p>
<ul>
<li>使用 sqlite3 创建的数据库将数据转为 df 相对麻烦</li>
<li>sqlalchemy 的灵活性使得 pd 可以很容易实现与数据库交互</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""
A database using  Python's built-in sqlite3 driver
"""</span>
<span class="token keyword">import</span> sqlite3
query <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
CREATE TABLE test
(a VARCHAR(20), b VARCHAR(20),
 c REAL,        d INTEGER
);"""</span>
con <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'mydata.sqlite'</span><span class="token punctuation">)</span>
con<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>query<span class="token punctuation">)</span>
con<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Atlanta'</span><span class="token punctuation">,</span> <span class="token string">'Georgia'</span><span class="token punctuation">,</span> <span class="token number">1.25</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">'Tallahassee'</span><span class="token punctuation">,</span> <span class="token string">'Florida'</span><span class="token punctuation">,</span> <span class="token number">2.6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">'Sacramento'</span><span class="token punctuation">,</span> <span class="token string">'California'</span><span class="token punctuation">,</span> <span class="token number">1.7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
stmt <span class="token operator">=</span> <span class="token string">"INSERT INTO test VALUES(?, ?, ?, ?)"</span>
con<span class="token punctuation">.</span>executemany<span class="token punctuation">(</span>stmt<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
con<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
Most Python SQL drivers (PyODBC, psycopg2, MySQLdb, pymssql, etc.) return a list
of tuples when selecting data from a table:
"""</span>
cursor <span class="token operator">=</span> con<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'select * from test'</span><span class="token punctuation">)</span>
rows <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""You can pass the list of tuples to the DataFrame constructor, but you also need the
column names, contained in the cursor’s description attribute:
"""</span>
cursor<span class="token punctuation">.</span>description
pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>rows<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> cursor<span class="token punctuation">.</span>description<span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token triple-quoted-string string">"""
The SQLAlchemy project is a popular Python SQL toolkit that abstracts
away many of the common differences between SQL databases.
"""</span>
<span class="token keyword">import</span> sqlalchemy <span class="token keyword">as</span> sqla
db <span class="token operator">=</span> sqla<span class="token punctuation">.</span>create_engine<span class="token punctuation">(</span><span class="token string">'sqlite:///mydata.sqlite'</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>read_sql<span class="token punctuation">(</span><span class="token string">'select * from test'</span><span class="token punctuation">,</span> db<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="算术运算和数据对齐">算术运算和数据对齐</h2>
<p>pd 最重要的一个功能是可以对不同索引的对象进行算术运算。以加法为例，它会匹配索引相同（行和列）的进行算术运算，再将索引不匹配的数据视作缺失值，但是也会添加到最后的运算结果中，从而组成加法运算的结果。</p>
<ul>
<li>如果想给缺失值赋予自己想要的值，则需要利用方法，以 add 为例<br>
<code>df1.add(df2,fill_value=0)</code></li>
</ul>
<p><img src="../md_imgs/Pandas/21.png" alt="image.png"><br>
r 表示翻转参数</p>
<h3 id="df-和-ser-之间的算术运算">Df 和 Ser 之间的算术运算</h3>
<p>与数组的不同维度的数组进行算术运算的方法相似，pd 会将 df 拆成 n 个一维的分别与 ser 进行匹配然后进行算术运算</p>
<blockquote>
<p>By default, arithmetic between DataFrame and Series matches the index of the Series<br>
on the DataFrame’s columns, broadcasting down the rows:</p>
</blockquote>
<p>如果有不匹配的索引，那么将会重新进行索引来形成一个联合：<br>
<img src="../md_imgs/Pandas/22.png" alt="image.png"><br>
<img src="../md_imgs/Pandas/23.png" alt="image.png"><br>
想要改变逐行进行匹配的广播机制，需要借助<code>df.sub(ser,axis='index')</code>方法：<br>
<img src="../md_imgs/Pandas/24.png" alt="image.png"></p>
<h3 id="数学运算">数学运算</h3>
<p>Numpy 基于元素的公式运算对于 pd 也适用</p>
<ul>
<li>np.abs(df)</li>
<li>df.apply(f,axis=’’)</li>
</ul>
<h2 id="数据转换">数据转换</h2>
<h3 id="数据转换">数据转换</h3>
<p>数据转换主要是通过定义一些函数来实现映射，下边介绍一种使用 map 函数的数据转换方法：</p>
<blockquote>
<p>The map method on a Series accepts a function or dict-like object containing a map‐<br>
ping</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'food'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'bacon'</span><span class="token punctuation">,</span> <span class="token string">'pulled pork'</span><span class="token punctuation">,</span> <span class="token string">'bacon'</span><span class="token punctuation">,</span>
                              <span class="token string">'Pastrami'</span><span class="token punctuation">,</span> <span class="token string">'corned beef'</span><span class="token punctuation">,</span> <span class="token string">'Bacon'</span><span class="token punctuation">,</span>
                              <span class="token string">'pastrami'</span><span class="token punctuation">,</span> <span class="token string">'honey ham'</span><span class="token punctuation">,</span> <span class="token string">'nova lox'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                     <span class="token string">'ounces'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7.5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
meat_to_animal <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">'bacon'</span><span class="token punctuation">:</span> <span class="token string">'pig'</span><span class="token punctuation">,</span>
    <span class="token string">'pulled pork'</span><span class="token punctuation">:</span> <span class="token string">'pig'</span><span class="token punctuation">,</span>
    <span class="token string">'pastrami'</span><span class="token punctuation">:</span> <span class="token string">'cow'</span><span class="token punctuation">,</span>
    <span class="token string">'corned beef'</span><span class="token punctuation">:</span> <span class="token string">'cow'</span><span class="token punctuation">,</span>
    <span class="token string">'honey ham'</span><span class="token punctuation">:</span> <span class="token string">'pig'</span><span class="token punctuation">,</span>
    <span class="token string">'nova lox'</span><span class="token punctuation">:</span> <span class="token string">'salmon'</span>
<span class="token punctuation">&#125;</span>
lowercased <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'food'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
lowercased
data<span class="token punctuation">[</span><span class="token string">'animal'</span><span class="token punctuation">]</span> <span class="token operator">=</span> lowercased<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>meat_to_animal<span class="token punctuation">)</span>
data
data<span class="token punctuation">[</span><span class="token string">'food'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> meat_to_animal<span class="token punctuation">[</span>x<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>同样的方法，也可以用来对 df 的轴标签进行重新索引，只不过操作对象变成了 df.index</p>
<h3 id="df-replace">df.replace()</h3>
<p>df.replace()主要接受两个参数，第一个参数表示被替换值，第二个参数表示替换值，这两个参数可以是两个等长的列表（一一匹配），亦可以是一个字典键值对匹配即可。<br>
在多数情况下，对时间类型数据进行分析的前提就是将原本为字符串的时间转换为标准时间类型。pandas 继承了 NumPy 库和 datetime 库的时间相关模块，提供了 6 种时间相关的类。</p>
<h3 id="df-str-replace">df.str.replace</h3>
<blockquote>
<p>The data.replace method is distinct from data.str.replace, which performs string substitution element-wise. （按元素执行字符串匹配）We look at these string methods on Series later in the chapter.</p>
</blockquote>
<h2 id="时间序列数据">时间序列数据</h2>
<blockquote>
<p>A basic kind of time series object in pandas is a <strong>Series</strong> indexed by timestamps, which is often represented external to pandas as Python strings or datetime objects</p>
</blockquote>
<h3 id="创建">创建</h3>
<p>pd 的<code>to_datetime</code>能够将字符串解析为时间对象，并会将缺失值记作‘NAT’，该函数解析之后会返回一个 timestamp 对象，该对象的</p>
<blockquote>
<p>NaT (Not a Time) is pandas’s null value for timestamp data.</p>
</blockquote>
<h4 id="timestamp-时间点">Timestamp–时间点</h4>
<p>多个 timestamp 对象储存在一个 series 或者 df 或者列表中时，这些对象是通过 datetimeindex 组织起来的。</p>
<h5 id="常用属性">常用属性</h5>
<ul>
<li>在多数涉及时间相关的数据处理，统计分析的过程中，需要提取时间中的年份，月份等数据。使用对应的 Timestamp 类属性就能够实现这一目的。</li>
<li>结合 Python 列表推导式，可以实现对 DataFrame 某一列时间信息数据的提取</li>
</ul>
<p><img src="../md_imgs/Pandas/25.png" alt="image.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">year1 <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token punctuation">.</span>year <span class="token keyword">for</span> i <span class="token keyword">in</span> order<span class="token punctuation">[</span><span class="token string">'lock_time'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'lock_time中的年数据前5个为：'</span><span class="token punctuation">,</span>year1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
month1 <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token punctuation">.</span>month <span class="token keyword">for</span> i <span class="token keyword">in</span> order<span class="token punctuation">[</span><span class="token string">'lock_time'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'lock_time中的月数据前5个为：'</span><span class="token punctuation">,</span>month1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
day1 <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token punctuation">.</span>day <span class="token keyword">for</span> i <span class="token keyword">in</span> order<span class="token punctuation">[</span><span class="token string">'lock_time'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'lock_time中的日数据前5个为：'</span><span class="token punctuation">,</span>day1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
dayname1 <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token punctuation">.</span>day_name <span class="token keyword">for</span> i <span class="token keyword">in</span> order<span class="token punctuation">[</span><span class="token string">'lock_time'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'lock_time中的日期数据前5个为：'</span><span class="token punctuation">,</span>dayname1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="datetimeindex-与-periodindex-函数">DatetimeIndex 与 PeriodIndex 函数</h4>
<p>除了将数据字原始 DataFrame 中直接转换为 Timestamp 格式外，还可以将数据<strong>单独提取出来</strong>将其转换为 DatetimeIndex 或者 PeriodIndex。DatetimeIndex 是用来指代一系列时间点的一种数据结构，而 PeriodIndex 则是用来指代一系列时间段的数据结构。<br>
转换为 PeriodIndex 的时候需要注意，需要通过<strong>freq 参数</strong>指定时间间隔，常用的时间间隔有 Y 为年，M 为月，D 为日，H 为小时，T 为分钟，S 为秒。两个函数可以用来转换数据还可以用来创建时间序列数据，其参数非常类似。</p>
<h5 id="参数名称及说明">参数名称及说明</h5>
<p><img src="../md_imgs/Pandas/26.png" alt="image.png"><br>
<img src="../md_imgs/Pandas/27.png" alt="image.png"></p>
<h4 id="timedelta-不同单位的时间">Timedelta–不同单位的时间</h4>
<p>Timedelta 是时间相关的类中的一个异类，不仅能够使用正数，还能够使用负数表示单位时间，例如 1 秒，2 分钟，3 小时等。使用 Timedelta 类，配合常规的时间相关类能够轻松实现时间的算术运算。目前 Timedelta 函数中时间周期中没有年和月。所有周期名称，对应单位及其说明如下表所示。<br>
<img src="../md_imgs/Pandas/28.png" alt="image.png"><br>
<img src="../md_imgs/Pandas/29.png" alt="image.png"></p>
<h4 id="timedeltaindex">TimedeltaIndex</h4>
<p>一组 Timedelta 构成的 Index，可以用来作为 Series 或者 DataFrame 的索引</p>
<h3 id="访问">访问</h3>
<p>时间序列数据的访问其实可以参考 pandas 的 series 的访问方式，既可以使用 se.index[2]获取行索引的值进行访问，也可以直接调用行索引值进行访问，不过比较方便的是，索引值可以是一个可以被翻译为日期的字符串（功能比较灵活，甚至可以输入年份的字符串匹配所有符合年份的数据，也允许使用：作为索引标签）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> IPython<span class="token punctuation">.</span>core<span class="token punctuation">.</span>interactiveshell <span class="token keyword">import</span> InteractiveShell
InteractiveShell<span class="token punctuation">.</span>ast_node_interactivity <span class="token operator">=</span> <span class="token string">'all'</span>
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
dates <span class="token operator">=</span> <span class="token punctuation">[</span>datetime<span class="token punctuation">(</span><span class="token number">2011</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> datetime<span class="token punctuation">(</span><span class="token number">2011</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         datetime<span class="token punctuation">(</span><span class="token number">2011</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> datetime<span class="token punctuation">(</span><span class="token number">2011</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         datetime<span class="token punctuation">(</span><span class="token number">2011</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> datetime<span class="token punctuation">(</span><span class="token number">2011</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
ts <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token operator">=</span>dates<span class="token punctuation">)</span>
ts
stamp <span class="token operator">=</span> ts<span class="token punctuation">.</span>index<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
ts<span class="token punctuation">[</span>stamp<span class="token punctuation">]</span>
ts<span class="token punctuation">[</span><span class="token string">'1/10/2011'</span><span class="token punctuation">]</span>
ts<span class="token punctuation">[</span><span class="token string">'20110110'</span><span class="token punctuation">]</span>
<span class="token triple-quoted-string string">'''
Because most time series data is ordered chronologically, you can slice with time‐
stamps not contained in a time series to perform a range query:
'''</span>
ts<span class="token punctuation">[</span>datetime<span class="token punctuation">(</span><span class="token number">2011</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要注意的是切片访问相当于在源时间序列上创建一个新的 view（和 numpy 一样的），言外之意是并没有 copy 数据，任何对 view 的修改会作用于原来的数据。<br>
截断访问：timeseries.truncate:<br>
<code> ts.truncate(after='1/9/2011'</code></p>
<h3 id="连续序列产生-frequencies">连续序列产生&amp;Frequencies</h3>
<p><code>pd.date_range(start, periods=100, freq,normalize=False)</code>,‘periods’参数用来指定生成的长度，一般在 start 或者 end 缺失时会用到(该函数默认按照天为间隔生成 DatetimeIndex 对象)。<br>
<code>freq</code>的可选参数有:<br>
<img src="../md_imgs/Pandas/2022-04-15-19-58-23.png" alt=""><br>
freq 参数传入的参数除了上述这种形式，还可以在基础的时间频率的基础上加一些数字，例如’4H’(Putting an integer before the base frequency creates a multiple:).还可以传入一下类似于’1h30min’的字符串，这个也可以被很好的解析。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'2000-01-01'</span><span class="token punctuation">,</span> <span class="token string">'2000-01-03 23:59'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'4h'</span><span class="token punctuation">)</span>
<span class="token comment">#week of chance enables you to get dates like the third Friday of each month</span>
rng <span class="token operator">=</span> pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'2012-01-01'</span><span class="token punctuation">,</span> <span class="token string">'2012-09-01'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'WOM-3FRI'</span><span class="token punctuation">)</span>
<span class="token builtin">list</span><span class="token punctuation">(</span>rng<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="指定频率的时间序列生成-频率转换和重采样">指定频率的时间序列生成(频率转换和重采样)</h3>
<p>pandas 支持处理在格式上间隔不相等的时间序列数据，但是有的时候我们希望生成或者转化成一些间隔相同时间序列数据。</p>
<blockquote>
<p>Fortunately pandas has a full suite of standard time series frequencies and tools for resampling, inferring frequencies, and generating fixed-frequency date ranges. For example, you can convert the sample time series to be fixed daily frequency by calling <strong>resample</strong>.</p>
</blockquote>
<h3 id="frequencies-and-date-offsets">Frequencies and Date Offsets</h3>
<p>对于基本的时间间隔，pandas 都提供了一个基础的 frequency，然后这些基础的 frequency 还可以借助乘法器组成 pd 里常用的一些 frequency。</p>
<blockquote>
<p>For each base frequency, there is an object defined generally referred to as a <strong>date offset</strong></p>
</blockquote>
<p>不均匀的间隔被叫做 anchored offsets。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pandas<span class="token punctuation">.</span>tseries<span class="token punctuation">.</span>offsets <span class="token keyword">import</span> Hour<span class="token punctuation">,</span> Minute
hour <span class="token operator">=</span> Hour<span class="token punctuation">(</span><span class="token punctuation">)</span>
hour
<span class="token comment">#define a multiple of an offset by passing an integer</span>
four_hours <span class="token operator">=</span> Hour<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
four_hours<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>pd 的这些 date offsets 也可以用在 datetime 和 timestamp 对象身上。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pandas<span class="token punctuation">.</span>tseries<span class="token punctuation">.</span>offsets <span class="token keyword">import</span> Day<span class="token punctuation">,</span> MonthEnd
<span class="token triple-quoted-string string">"""
If you add an anchored offset like MonthEnd, the first increment will “roll forward” a
date to the next date according to the frequency rule:
"""</span>
now <span class="token operator">+</span> MonthEnd<span class="token punctuation">(</span><span class="token punctuation">)</span>
now <span class="token operator">+</span> MonthEnd<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>感觉上边运算方式多多少少有些奇怪，这时可以考虑 anchored offset 的两个方法<code>rollforward</code>和<code>rollback</code>来 roll dates bakward and forward。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">offset <span class="token operator">=</span> MonthEnd<span class="token punctuation">(</span><span class="token punctuation">)</span>
offset<span class="token punctuation">.</span>rollforward<span class="token punctuation">(</span>now<span class="token punctuation">)</span>
offset<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span>now<span class="token punctuation">)</span>
<span class="token comment">#创新性地用在groupby中</span>
ts <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               index<span class="token operator">=</span>pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'1/15/2000'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'4d'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ts
ts<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>offset<span class="token punctuation">.</span>rollforward<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
ts<span class="token punctuation">.</span>resample<span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="period-时间跨度或时间段">Period–时间跨度或时间段</h4>
<blockquote>
<p>Periods represent timespans, like days, months, quarters, or years. The Period class represents this data type, requiring a string or integer and a frequency from Folloing Table.</p>
</blockquote>
<p><img src="../md_imgs/Pandas/2022-04-18-00-00-57.png" alt=""></p>
<p>You have two ways to create a Period Object:</p>
<ul>
<li>利用<code>pd.period(,freq)</code>#第一个参数可以是整数也可以是字符串，也可以是一个 frequency</li>
<li>利用<code>pd.period_range()</code>函数生成一个 Period 序列</li>
</ul>
<p>Period 对象支持数学运算(可以直接加减整数，感觉可以看做一个相同 freq 的对象)，如果两个对象的 frequency 相同的话，他们的差则会是整数(the number of units between them)</p>
<h5 id="periodtimeindex">PeriodtimeIndex</h5>
<p>借助<code>pd.period_range()</code>或者<code>pd.PeriodIndex(str/list,freq=)</code>来产生,一组 Period 构成的 Index，可以用来作为 Series 或者 DataFrame 的索引。<br>
<img src="../md_imgs/Pandas/30.png" alt="image.png"></p>
<h6 id="period-frequency-conversion">Period Frequency Conversion</h6>
<blockquote>
<p>Periods and PeriodIndex objects can be converted to another frequency with their <strong>asfreq</strong> method.</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">p <span class="token operator">=</span> pd<span class="token punctuation">.</span>Period<span class="token punctuation">(</span><span class="token string">'2007'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'A-DEC'</span><span class="token punctuation">)</span>
p
p<span class="token punctuation">.</span>asfreq<span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'start'</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>asfreq<span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'end'</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> pd<span class="token punctuation">.</span>Period<span class="token punctuation">(</span><span class="token string">'2007'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'A-JUN'</span><span class="token punctuation">)</span>
p
p<span class="token punctuation">.</span>asfreq<span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token string">'start'</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>asfreq<span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token string">'end'</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> pd<span class="token punctuation">.</span>Period<span class="token punctuation">(</span><span class="token string">'Aug-2007'</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>asfreq<span class="token punctuation">(</span><span class="token string">'A-JUN'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对于不同 frequency 的 period，大的 period 可以看成一系列小的 period 的排列，而两个不同 frequency 的 Period 转换也可以视为是 superperiod 与 subperiod 的转换。<br>
<img src="../md_imgs/Pandas/2022-04-18-14-42-58.png" alt=""></p>
<h2 id="shifting-leading-and-lagging-data">Shifting (Leading and Lagging) Data</h2>
<p>在对 df 或者 series 数据（包括时间序列）进行转换时有的时候可能需要把根据时间整体前移或者后移，这个时候就可以借助 df 和 se 的方法 shift，这种移动只是数据值的移动，索引不会改变（对于时间类型索引的数据，也可以通过指定 freq 参数来对索引进行整体的调整）。这种方法比较常见的应用场景是计算环比。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">ts <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               index<span class="token operator">=</span>pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'1/1/2000'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'M'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ts
ts<span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">#计算环比</span>
ts <span class="token operator">/</span> ts<span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="总体的随机排列-permutation-和随机抽样">总体的随机排列（permutation）和随机抽样</h2>
<h3 id="随机排列">随机排列</h3>
<p>随机排列可以借助 np.random.permutation(n)实现对 n 维数组的行索引进行一个随机排序，返回值为一个一维数组。然后可以利用 df.iloc 或者 df.take 函数来得到随机排序后的 df。</p>
<h3 id="随机抽样">随机抽样</h3>
<p>随机抽样用到的是 df.sample（n）函数，该函数返回值为对于 df 以行为抽样单位进行的随机抽样，返回值是从总体随机抽出的 n 行组成的 df（默认不可以重复，可以调整参数）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
a <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
sampler <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>permutation<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sampler<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>sampler<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>take<span class="token punctuation">(</span>sampler<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> replace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1>pandas 统计分析</h1>
<h2 id="数据预处理">数据预处理</h2>
<p>pd 在对数据进行处理时会默认不考虑缺失值（数值型数据的缺失值会被写作 NaN，另外需要注意的是 Python 内置的 None 也会被视为缺失值）</p>
<h3 id="data-cleaning">Data Cleaning</h3>
<h4 id="去重">去重</h4>
<ul>
<li>返回不重复数据：df.unique()</li>
<li>统计值：df.value_counts()（默认按列计算好像，返回的还是一个 dataframe，值有更改）</li>
<li>查找是否存在重复数据：df.duplicated()(返回布尔值，默认将已经观察到先前有之后的行返回 True 这个需要调整 keep 函数，默认查找全部列，也可以进行调整)<br>
<code>data.drop_duplicates(['k1']) </code>（只观察 k1 列）</li>
<li>去除重复数据：<code>pandas.DataFrame(Series).drop_duplicates()</code>方法。</li>
</ul>
<h4 id="缺失值插补">缺失值插补</h4>
<ul>
<li>pandas.DataFrame.<code>isnull()</code>和 pandas.DataFrame.<code>notnull()</code>方法识别缺失值和非缺失值。
<ul>
<li><code>df.isnull().any()</code>：判断存在缺失值的列</li>
<li><code>df.isnull().sum()</code>:将列中为空的个数统计出来</li>
</ul>
</li>
<li>对缺失值，可以使用 pandas.DataFrame.<code>dropna()</code>方法删除记录或特征(默认删除含有缺失值的行，可以修改 how 参数进行调节，也可以调节 thresh 参数控制删除指定数量缺失值的行)</li>
<li>也可以使用 pandas.DataFrame.<code>fillna()</code>方法进行常量填补（）
<ul>
<li>输入字典来指定每一列的填补值</li>
<li>调整 inplace 参数直接在原 df 上修改</li>
<li>method 参数可以选择填补方法，使用的方法有’ffill’,‘bfill’</li>
<li>limit 参数可以指明对缺失值多少个的值进行填补</li>
<li>也可以利用原数据集的均值进行填补（<code>data.fillna(data.mean()) </code>）</li>
</ul>
</li>
<li>或者使用 pandas.DataFrame.interpolate(), SciPy 的 interpolate 方法进行线性差值、多项式插值、样条插值。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#拉格朗日插值方法</span>
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>interpolate <span class="token keyword">import</span> lagrange
	<span class="token comment">#自定义列向量插值函数,s为列向量,n为被插值的位置,k为取前后的数据个数，	默认5</span>
	<span class="token keyword">def</span> <span class="token function">ployinterp_columns</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> n<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		y <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token operator">-</span>k<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">#取数</span>
		y <span class="token operator">=</span> y<span class="token punctuation">[</span>y<span class="token punctuation">.</span>notnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">#剔除空值</span>
		<span class="token keyword">return</span> lagrange<span class="token punctuation">(</span>y<span class="token punctuation">.</span>index<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">#插值并返回插值结果</span>
		<span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">.</span>columns<span class="token punctuation">:</span>  		<span class="token comment">#逐个元素判断是否需要插值</span>
			<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token comment">#如果为空即插值</span>
				data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> ployinterp_columns<span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>j<span class="token punctuation">)</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="截断">截断</h4>
<p><code>df.clip()</code></p>
<h4 id="异常值检测">异常值检测</h4>
<p>异常值的检测主要是根据已有的需求对 df 进行一个筛选，然后通过赋值操作来剔除不需要的异常值。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
a <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token operator">*</span><span class="token number">80</span><span class="token punctuation">)</span>
a<span class="token punctuation">[</span>a <span class="token operator">></span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="转换数据-哑变量处理-index-dummy-variables">转换数据–哑变量处理（Index/dummy Variables）</h4>
<ul>
<li>当特征为分类型时，例如职业、学历、血型、疾病严重程度等等，通常会将原始的多分类变量转化为数值型，这种转化后的特征（或变量）称为哑变量，又称为虚拟变量、虚设变量或名义变量。</li>
<li>它是人为虚设的变量，通常取值为 0 或 1，来反映<strong>某个变量的不同属性</strong>。</li>
<li>哑变量的处理过程实际上就是分类型特征的值的编码过程。Pandas 提供了哑变量处理方法<code>pandas.getdummies().</code></li>
</ul>
<blockquote>
<p>这个地方联想一下独热编码，哑变量处理其实进行一个one-hot编码</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> replace
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'key'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                   <span class="token string">'data1'</span><span class="token punctuation">:</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"初始的df为:\n"</span><span class="token punctuation">,</span> df<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"根据key值列得到的指示变量:\n"</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#可以调整prefix参数给指示变量加上前缀名称</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../md_imgs/Pandas/31.png" alt="image.png"></p>
<h4 id="字符串数据">字符串数据</h4>
<p>对字符串的操作有使用字符串内置函数和 re 库进行正则表达式匹配两种方法，pd 将这两种方法都加在了 df 或者 series 对象的 str 属性中，通过 df/series.str.method_name 就可以使用了。直接调用内置的字符串处理函数会有一个问题是这些函数并没有定义 nan 数据的处理方式，因此最好借助 str 属性进行调用。感觉 series.str 就可以看成是一个字符串对象，然后就可以对这个对象调用一些字符串用的方法，包括索引什么的（通过装饰器把函数当属性用）。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'Dave'</span><span class="token punctuation">:</span> <span class="token string">'dave@google.com'</span><span class="token punctuation">,</span> <span class="token string">'Steve'</span><span class="token punctuation">:</span> <span class="token string">'steve@gmail.com'</span><span class="token punctuation">,</span>
        <span class="token string">'Rob'</span><span class="token punctuation">:</span> <span class="token string">'rob@gmail.com'</span><span class="token punctuation">,</span> <span class="token string">'Wes'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">&#125;</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
data
data<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">'gmail'</span><span class="token punctuation">)</span>
matches <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> flags<span class="token operator">=</span>re<span class="token punctuation">.</span>IGNORECASE<span class="token punctuation">)</span>
<span class="token comment">#对查询结果的索引方式，直接索引或者借助str.get</span>
 matches<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
matches<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>就是因为有 nan 值的存在导致一些本来可以直接用的内置函数要做一些调整：<br>
<img src="../md_imgs/Pandas/32.png" alt="image.png"><br>
<img src="../md_imgs/Pandas/33.png" alt="image.png">0</p>
<h4 id="重置索引">重置索引</h4>
<p>数据清洗时，会将带空值的行删除，此时 DataFrame 或 Series 类型的数据不再是连续的索引，可以使用<code>reset_index()</code>重置索引。</p>
<h4 id="数据筛选">数据筛选</h4>
<p><img src="../md_imgs/Pandas/34.png" alt="image.png"></p>
<h3 id="数据整理">数据整理</h3>
<p>This section focuses on tools to help combine, join, and rearrange data.<br>
这一部分主要介绍了一些将多个 df 的数据组合起来的一些方法：</p>
<ul>
<li>Join and Merge 部分主要侧重于类似于 SQL 查询的多表查询和联合的方法</li>
<li>Concatenating 和 numpy 的 concatenate 有些类似，主要应用于沿某一个轴进行拼接</li>
<li>combine 方法主要用来对两个表的数据进行 combine，具体 combine 的方法依据传递的函数的返回值</li>
</ul>
<h4 id="堆叠合并数据">堆叠合并数据</h4>
<ul>
<li>纵向合并数据表:<code>pandas.append()</code>方法</li>
</ul>
<ol>
<li><strong>多个 dataframe 连接（通过 index 匹配进行）（Join and Merge</strong></li>
</ol>
<ul>
<li>通过一个或多个键将两个数据集的列连接起来（完成 SQl 的 join 操作）:<code>pandas.merge()</code>函数和<code>pandas.DataFrame.join()</code>方法，多表的连接要把被连接的 df 名称以列表的形式传入
<ul>
<li>pd.merge(df1,df2,on=‘column_name’)</li>
<li>pd.merge(df1,df2,left_on=’’,right_on=’’)</li>
<li>how：表示数据库的 join 方式，默认是 inner join。可选的有’left’,‘right’,‘output’</li>
<li>在对多个表进行 join 的时候，行索引会被丢弃</li>
<li><img src="../md_imgs/Pandas/35.png" alt="image.png"></li>
<li>观察参数表可知也可以通过一个的行索引与另外一个表的列索引进行 join（甚至适用于行标签为多级索引的情况）</li>
<li><code>df.join()</code>方法适用于那些 index 相似或者相同且没有重复列的 dfs,默认使用行索引匹配也支持一个 df 的行索引英语另一个 df 的列索引 join 起来</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">left1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'key'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token string">'value'</span><span class="token punctuation">:</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
right1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'group_val'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3.5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>left1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>right1<span class="token punctuation">)</span>
left1<span class="token punctuation">.</span>join<span class="token punctuation">(</span>right1<span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token string">'key'</span><span class="token punctuation">)</span>
left2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">4.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5.</span><span class="token punctuation">,</span> <span class="token number">6.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                     index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                     columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Ohio'</span><span class="token punctuation">,</span> <span class="token string">'Nevada'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
right2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">7.</span><span class="token punctuation">,</span> <span class="token number">8.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9.</span><span class="token punctuation">,</span> <span class="token number">10.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">11.</span><span class="token punctuation">,</span> <span class="token number">12.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Missouri'</span><span class="token punctuation">,</span> <span class="token string">'Alabama'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>left2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>right2<span class="token punctuation">)</span>
right2
left2<span class="token punctuation">.</span>join<span class="token punctuation">(</span>right2<span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'outer'</span><span class="token punctuation">)</span>、
another <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">7.</span><span class="token punctuation">,</span> <span class="token number">8.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9.</span><span class="token punctuation">,</span> <span class="token number">10.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">11.</span><span class="token punctuation">,</span> <span class="token number">12.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">16.</span><span class="token punctuation">,</span> <span class="token number">17.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                       index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                       columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'New York'</span><span class="token punctuation">,</span> <span class="token string">'Oregon'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
another
left2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>right2<span class="token punctuation">,</span> another<span class="token punctuation">]</span><span class="token punctuation">)</span>
left2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>right2<span class="token punctuation">,</span> another<span class="token punctuation">]</span><span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'outer'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>**dfs 沿轴拼接（不进行 index 匹配）（**Concatenating</li>
</ol>
<p>沿轴拼接的好处：</p>
<ul>
<li>拼接后的数据可以看到数据的来源</li>
<li>拼接的时候需要删除默认的整数标签</li>
<li>join 或者 merge 方法实现的其实是表的横向拼接，需要纵向拼接时的情况</li>
</ul>
<p>df 的拼接是从 numpy 的拼接引入的，选择沿着不同的轴进行匹配会产生不同的结果，具体匹配情况可以类比数组的拼接，区别是沿着 axis=1 进行叠加时会考虑行索引相同的进行合并。</p>
<ul>
<li>数据横向、纵向堆叠：<code>pandas.concat([],axis=,join=)</code>（可以通过 keys 来在合并轴上创建层次索引）</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s1<span class="token operator">=</span>pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>
    <span class="token punctuation">&#123;</span>
        <span class="token string">'height'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1.4</span><span class="token punctuation">,</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">1.6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'weight'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">160</span><span class="token punctuation">,</span><span class="token number">180</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span><span class="token string">'xiaohonng'</span><span class="token punctuation">,</span><span class="token string">'xiaowang'</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>
s1
s2<span class="token operator">=</span>pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>
    <span class="token punctuation">&#123;</span>
        <span class="token string">'age'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'sex'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'male'</span><span class="token punctuation">,</span><span class="token string">'female'</span><span class="token punctuation">,</span><span class="token string">'male'</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span><span class="token string">'xiaohonng'</span><span class="token punctuation">,</span><span class="token string">'xiaowang'</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>
s2
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>s1<span class="token punctuation">,</span>s2<span class="token punctuation">]</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>s1<span class="token punctuation">,</span>s2<span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'体型'</span><span class="token punctuation">,</span><span class="token string">'个人信息'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#写成字典形式</span>
<span class="token comment">#pd.concat(&#123;'体型': df1, '个人信息': df2&#125;, axis=1)</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>s1<span class="token punctuation">,</span>s4<span class="token punctuation">]</span><span class="token punctuation">,</span>keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'表1'</span><span class="token punctuation">,</span><span class="token string">'表2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../md_imgs/Pandas/36.png" alt="image.png"><br>
<img src="../md_imgs/Pandas/37.png" alt="image.png"></p>
<ol start="3">
<li></li>
</ol>
<p>combine 也是适用于 index 部分或者全部相似的情况，combine 的其实是两个表的值，有点类似于 numpy 的 where 函数，是 if-else 功能的一个等价表示。两种使用方法，一种是 np.where()方法，一种是 pd.combine(self,df,func)(func 为一个传入两个参数的函数。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
a <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">,</span> <span class="token number">4.5</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">]</span><span class="token punctuation">,</span>
              index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span><span class="token punctuation">,</span>
              index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#b[-1] = np.nan</span>
a
b
np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>pd<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
b<span class="token punctuation">.</span>combine<span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token builtin">max</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>pd.combine_first(self,other):将 self 的空值用但缺失值会用 other 的对应值进行填充。</li>
</ul>
<h4 id="数据重塑">数据重塑</h4>
<h5 id="行列索引的重塑">行列索引的重塑</h5>
<p>多级标签的重塑主要借助 stack 和 unstack 方法：</p>
<ul>
<li>stack：This “rotates” or pivots from the columns in the data to the rows、</li>
<li>unstack：This pivots from the rows into the columns</li>
</ul>
<p>两个函数默认都从最低层级开始操作，然后将转换为另外一个轴的最低层级，可以传入 df 的层级名称或者数字来强制修改操作层级，另外就是堆叠数据（stack 方法）的时候默认是删除缺失值的，可以通过调节 dropna 参数进行调整。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    index<span class="token operator">=</span>pd<span class="token punctuation">.</span>Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Ohio'</span><span class="token punctuation">,</span> <span class="token string">'Colorado'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    columns<span class="token operator">=</span>pd<span class="token punctuation">.</span>Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    name<span class="token operator">=</span><span class="token string">'number'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> data<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">)</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'left'</span><span class="token punctuation">:</span> result<span class="token punctuation">,</span> <span class="token string">'right'</span><span class="token punctuation">:</span> result <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                  columns<span class="token operator">=</span>pd<span class="token punctuation">.</span>Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'left'</span><span class="token punctuation">,</span> <span class="token string">'right'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'side'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df
df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Ohio'</span><span class="token punctuation">,</span><span class="token string">'three'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment">#df.drop(index=['three'],level='number',inplace=True)#会删除二级索引为number的所有行</span>
df
df<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token string">'side'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token string">'side'</span><span class="token punctuation">,</span>dropna<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token string">'Ohio'</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>level<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token string">'Ohio'</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>level<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token string">'side'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token string">'Ohio'</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>level<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token string">'side'</span><span class="token punctuation">,</span>dropna<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="行列值的重塑-数据透视-逆运算-long-wide">行列值的重塑（数据透视+逆运算，long→wide）</h5>
<p>这部分主要介绍的是 pivot 函数，pivot 函数实现的是数据从长的形式向宽的形式的转换，一般意义上来说，我们认为存储在 csv 或者数据库中的文件属于长的格式（有多个索引的 key 参数，只有一个 value）。pivot 函数要做的其实就是根据一个 key 的离散取值来把长的表给变成宽的表。<br>
<code>df.pivot('column_1','column_2','column_3)</code><br>
df 是一个我们希望转化的长的表，上述语句的意思其实就是我们希望用原来 df 的’column_1’作为行索引,'column_2’作为列索引,'column_3’作为值对 df 进行一次重整：<br>
<img src="../md_imgs/Pandas/38.png" alt="image.png"><br>
如果不指定最后一个参数，默认会创建多级索引（等价于：<code>df.set_index(['column_1','column_2]).uhstack('column_2')</code>（pivot()其实就是用 set_index()创建层次化索引，再用 unstack()重塑）</p>
<h5 id="wide-long">wide→long</h5>
<p>pivot 的一个逆运算是 pd.melt(),这个是用来将多列转化一列：<br>
<code>pd.melt(df, id_vars=['key'], value_vars=['A', 'B'])</code><br>
不指明的情况下将会使用默认的整数索引</p>
<h3 id="数据标准化">数据标准化</h3>
<h2 id="数据分组和聚合操作">数据分组和聚合操作</h2>
<blockquote>
<p>After loading, merging, and preparing a dataset, you may need to compute group statistics<br>
or possibly pivot tables for reporting or visualization purposes. pandas provides a<br>
flexible groupby interface, enabling you to slice, dice, and summarize datasets in a<br>
natural way.</p>
</blockquote>
<h3 id="分组">分组</h3>
<p><img src="../md_imgs/Pandas/39.png" alt="image.png"><br>
python 中可以作为分组键的类型：</p>
<ul>
<li>列名</li>
<li>和分组数据等长的数组或者列表</li>
<li>一个指明分组名称和分组值关系的字典或者 series</li>
<li>A function to be invoked on the axis index or the individual labels in the index。</li>
</ul>
<ol>
<li>分组的操作轴默认为 axis=0,也可以进行调整</li>
<li>对于多级标签的对象，也可以指定 level 参数</li>
<li>调整 as_index 参数返回不带行标签的索引结果（取消两个及以上分组键的分组结果的多级索引）</li>
<li>调整 group_keys 参数，决定是否显示分组键索引</li>
<li>一般用分组键的取值作为行索引，如果是传入一个函数用来分组，那么默认借助函数的返回值作为索引。</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'key1'</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                   <span class="token string">'key2'</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                   <span class="token string">'data1'</span> <span class="token punctuation">:</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   <span class="token string">'data2'</span> <span class="token punctuation">:</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">#列名</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'key1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#等长的series作为分组键</span>
df<span class="token punctuation">[</span><span class="token string">'data1'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#列表或者数组</span>
df<span class="token punctuation">[</span><span class="token string">'data1'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>df<span class="token punctuation">[</span><span class="token string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
states <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Ohio'</span><span class="token punctuation">,</span> <span class="token string">'California'</span><span class="token punctuation">,</span> <span class="token string">'California'</span><span class="token punctuation">,</span> <span class="token string">'Ohio'</span><span class="token punctuation">,</span> <span class="token string">'Ohio'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
years <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">2006</span><span class="token punctuation">,</span> <span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">2006</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df<span class="token punctuation">[</span><span class="token string">'data1'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span>states<span class="token punctuation">,</span>  years<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#Grouping with Dicts and Series</span>
people <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Joe'</span><span class="token punctuation">,</span> <span class="token string">'Steve'</span><span class="token punctuation">,</span> <span class="token string">'Wes'</span><span class="token punctuation">,</span> <span class="token string">'Jim'</span><span class="token punctuation">,</span> <span class="token string">'Travis'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
people<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>nan <span class="token comment"># Add a few NA values</span>
people
mapping <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">:</span> <span class="token string">'blue'</span><span class="token punctuation">,</span>
           <span class="token string">'d'</span><span class="token punctuation">:</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'f'</span> <span class="token punctuation">:</span> <span class="token string">'orange'</span><span class="token punctuation">&#125;</span>
by_column <span class="token operator">=</span> people<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>mapping<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
by_column<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
map_series <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>mapping<span class="token punctuation">)</span>
map_series
people<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>map_series<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#Grouping with Functions</span>
people<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">columns <span class="token operator">=</span> pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_arrays<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'US'</span><span class="token punctuation">,</span> <span class="token string">'US'</span><span class="token punctuation">,</span> <span class="token string">'US'</span><span class="token punctuation">,</span> <span class="token string">'JP'</span><span class="token punctuation">,</span> <span class="token string">'JP'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                    names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'cty'</span><span class="token punctuation">,</span> <span class="token string">'tenor'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
hier_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> columns<span class="token operator">=</span>columns<span class="token punctuation">)</span>
hier_df
hier_df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>level<span class="token operator">=</span><span class="token string">'cty'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要注意的是，分组键的值为空的数据将会被移出。</p>
<h4 id="groupby-object">Groupby object</h4>
<p>分组后生成的对象支持迭代，默认一个迭代对象是两个分别包含组名和数据的元组，元组的具体情况要根据分组的情况而定（分组键的数量之类的）。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> <span class="token punctuation">(</span>k1<span class="token punctuation">,</span> k2<span class="token punctuation">)</span><span class="token punctuation">,</span> group <span class="token keyword">in</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'key1'</span><span class="token punctuation">,</span> <span class="token string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k1<span class="token punctuation">,</span> k2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span>
<span class="token comment">#将分组结果转化为字典形式的方法</span>
pieces <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'key1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pieces<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>分组后的对象其实可以视作一个新的 df 或者 se(SeriesGroupBy object)，名字即为分组键的值（如果是通过传递函数进行分组那么索引值就是函数的返回值），当数据集比较大时，我们有时候只希望对分组结果的部分列进行运算，因此可以写成类似于下边的形式：<br>
<code>df.groupby(['key1', 'key2'])[['data2']].mean()</code></p>
<p>分组后可以进行的操作：</p>
<ul>
<li>描述性统计分析（见描述性统计分析）</li>
<li>聚合运算</li>
</ul>
<p>函数的灵活使用</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">frame <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'data1'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token string">'data2'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
quartiles <span class="token operator">=</span> pd<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>frame<span class="token punctuation">.</span>data1<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
quartiles<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">get_stats</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'min'</span><span class="token punctuation">:</span> group<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">:</span> group<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'count'</span><span class="token punctuation">:</span> group<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'mean'</span><span class="token punctuation">:</span> group<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
grouped <span class="token operator">=</span> frame<span class="token punctuation">.</span>data2<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>quartiles<span class="token punctuation">)</span>
grouped<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>get_stats<span class="token punctuation">)</span><span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Return quantile numbers</span>
grouping <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>frame<span class="token punctuation">.</span>data1<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
grouped <span class="token operator">=</span> frame<span class="token punctuation">.</span>data2<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>grouping<span class="token punctuation">)</span>
grouped<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>get_stats<span class="token punctuation">)</span><span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">states <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Ohio'</span><span class="token punctuation">,</span> <span class="token string">'New York'</span><span class="token punctuation">,</span> <span class="token string">'Vermont'</span><span class="token punctuation">,</span> <span class="token string">'Florida'</span><span class="token punctuation">,</span>
          <span class="token string">'Oregon'</span><span class="token punctuation">,</span> <span class="token string">'Nevada'</span><span class="token punctuation">,</span> <span class="token string">'California'</span><span class="token punctuation">,</span> <span class="token string">'Idaho'</span><span class="token punctuation">]</span>
group_key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'East'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token string">'West'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">4</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token operator">=</span>states<span class="token punctuation">)</span>
data
data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Vermont'</span><span class="token punctuation">,</span> <span class="token string">'Nevada'</span><span class="token punctuation">,</span> <span class="token string">'Idaho'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>nan
data
data<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>group_key<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
fill_mean <span class="token operator">=</span> <span class="token keyword">lambda</span> g<span class="token punctuation">:</span> g<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>g<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>group_key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>fill_mean<span class="token punctuation">)</span>
fill_values <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'East'</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token string">'West'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">&#125;</span>
fill_func <span class="token operator">=</span> <span class="token keyword">lambda</span> g<span class="token punctuation">:</span> g<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>fill_values<span class="token punctuation">[</span>g<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>group_key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>fill_func<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Hearts, Spades, Clubs, Diamonds</span>
suits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'H'</span><span class="token punctuation">,</span> <span class="token string">'S'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">]</span>
card_val <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span>
base_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token string">'J'</span><span class="token punctuation">,</span> <span class="token string">'K'</span><span class="token punctuation">,</span> <span class="token string">'Q'</span><span class="token punctuation">]</span>
cards <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> suit <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'H'</span><span class="token punctuation">,</span> <span class="token string">'S'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    cards<span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">+</span> suit <span class="token keyword">for</span> num <span class="token keyword">in</span> base_names<span class="token punctuation">)</span>

deck <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>card_val<span class="token punctuation">,</span> index<span class="token operator">=</span>cards<span class="token punctuation">)</span>
deck<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">13</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">draw</span><span class="token punctuation">(</span>deck<span class="token punctuation">,</span> n<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> deck<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
draw<span class="token punctuation">(</span>deck<span class="token punctuation">)</span>
get_suit <span class="token operator">=</span> <span class="token keyword">lambda</span> card<span class="token punctuation">:</span> card<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment"># last letter is suit</span>
deck<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>get_suit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>draw<span class="token punctuation">,</span> n<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="聚合">聚合</h3>
<p><img src="../md_imgs/Pandas/40.png" alt="聚合数据的三种方法.png"><br>
除了 Series 方法 quantile 函数不支持对 groupby 后的 df 直接使用以外，常见的统计描述函数都可以直接在 dfGroupBy 上进行聚合操作，为了使用我们自定义的聚合函数，这里引入 python 的一些函数</p>
<h3 id="使用-agg-方法聚合数据">使用 agg 方法聚合数据</h3>
<p>agg，aggregate 方法都支持对每个分组应用某函数，包括 Python 内置函数或自定义函数。同时这两个方法能够也能够直接对 DataFrame 进行函数应用操作。<br>
在正常使用过程中，agg 函数和 aggregate 函数对 DataFrame 对象操作时功能几乎完全相同，因此只需要掌握其中一个函数即可。它们的参数说明如下表。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">DataFrame<span class="token punctuation">.</span>agg<span class="token punctuation">(</span>func<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
DataFrame<span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>func<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>func 接收函数、字符串、字典，或函数与字符串的列表。</p>
<ul>
<li>传入一个函数名组成的列表，则会将每一个函数的函数名作为返回值的列名</li>
<li>传入一个字典格式，可以用字典的 index 定义列名</li>
</ul>
<p>自定义函数时的一点注意事项<br>
自定义的函数应该是一个用来聚合数组类型数据的函数。这里和 quantile 函数不能用是一样的原因。pd 的统计描述函数是从 np 继承过来的因此写成 np.min 没有差别<br>
<img src="../md_imgs/Pandas/41.png" alt="image.png"><br>
agg()方法对分组对象进行聚合计算</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'汽车销售表分组后前5组每组的均值为：\n'</span><span class="token punctuation">,</span>
     vsGroup<span class="token punctuation">.</span>agg<span class="token punctuation">(</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="使用-apply-方法聚合数据">使用 apply 方法聚合数据</h3>
<p><img src="../md_imgs/Pandas/42.png" alt="image.png"></p>
<blockquote>
<p>apply splits the object being manipulated into pieces, invokes the passed function on each piece, and then attempts to concatenate（pd.concat） the pieces together.</p>
</blockquote>
<p>如果只是对 DataFrame 对象或分组对象进行统一的统计计算，也可以使用 groupby 对象的方法 apply，其格式为：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">DataFrame<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> broadcast<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> raw<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
 <span class="token builtin">reduce</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> result_type<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwds<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>其中可变长参数主要是输入一些 func 需要的其他参数<br>
<img src="../md_imgs/Pandas/43.png" alt="image.png"></p>
<h3 id="使用-transform-方法聚合数据">使用 transform 方法聚合数据</h3>
<p>Pandas 提供了<code>transform()</code>方法对 DataFrame 对象和分组对象的指定列进行统计计算，统计计算可以使用用户自定义函数。<br>
其格式为：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pythonDataFrame<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>func<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>其中<code>func</code>接收用于统计计算的函数。其形式为一般为<code>lambda x: f(x)</code>. 其中 x 为 DataFrame 或分组对象 GroupBy object 的列的泛指。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#Z-score标准化，即缩放为均值为0，标准差为1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'汽车销售表分组后实现组内Z-score标准化后前五行为：\n'</span><span class="token punctuation">,</span>
      vsGroup<span class="token punctuation">.</span>transform<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> x<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span>
      x<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="透视表和交叉表">透视表和交叉表</h2>
<p><img src="../md_imgs/Pandas/44.png" alt="数据透视表创建.png"></p>
<h3 id="使用-pivot-table-创建透视表">使用 pivot_table 创建透视表</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#fill_value表示空值的填充值</span>
pythonpandas<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>data<span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
columns<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token string">'mean'</span><span class="token punctuation">,</span> fill_value<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> margins<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
dropna<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> margins_name<span class="token operator">=</span><span class="token string">'All'</span><span class="token punctuation">)</span>
DataFrame<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>values<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
columns<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token string">'mean'</span><span class="token punctuation">,</span> fill_value<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> margins<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
dropna<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> margins_name<span class="token operator">=</span><span class="token string">'All'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../md_imgs/Pandas/45.png" alt="image.png"><br>
all 的值是对应行或者列的平均值</p>
<ul>
<li>参数调节注意事项<br>
<img src="../md_imgs/Pandas/46.png" alt="image.png"></li>
</ul>
<p>分组键设置为两个时，在分组时两个键有先后顺序。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#将空值以0填充，对index指定的分组键添加汇总数据</span>
vsPivot <span class="token operator">=</span> pd<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>vs<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'salesman_name'</span><span class="token punctuation">,</span>'
    vehicle_type<span class="token string">', '</span>counts<span class="token string">','</span>amounts'<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    index <span class="token operator">=</span> <span class="token string">'salesman_name'</span><span class="token punctuation">,</span>
    columns<span class="token operator">=</span><span class="token string">'vehicle_type'</span><span class="token punctuation">,</span>
    aggfunc <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">,</span>
    fill_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    margins <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment">#使用numpy.sum,空值填0</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>'以salesman_name和vehicle_type作为行、列分组
    键创建\的汽车销售数据透视表为：\n'<span class="token punctuation">,</span>
    vsPivot<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="使用-crosstab-创建交叉表">使用 crosstab 创建交叉表</h3>
<blockquote>
<p>A cross-tabulation (or crosstab for short) is a special case of a pivot table that com‐<br>
putes group frequencies.</p>
</blockquote>
<p>交叉表是一种特殊的数据透视表，它仅指定一个特征作为行分组键，一个特征作为列分组键，是为交叉的意思。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pandas<span class="token punctuation">.</span>crosstab<span class="token punctuation">(</span>index<span class="token punctuation">,</span> columns<span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> rownames<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
colnames<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> aggfunc<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> margins<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> margins_name<span class="token operator">=</span><span class="token string">'All'</span>
<span class="token punctuation">,</span> dropna<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> normalize<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>index：生成交叉表的行索引标签</li>
<li>columns：生成交叉表的列标签</li>
<li>value:表格的值，既可以是数组或者 series 也可以是数组列表</li>
</ul>
<p>**其它参数与 pandas.pivot_table()方法类似。**注意<code>rownames</code>为行分组键的名称，默认应该是 index 参数对应的列名。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#以vehicle_type作为行、salesman_name为列</span>
vsCross <span class="token operator">=</span> pd<span class="token punctuation">.</span>crosstab<span class="token punctuation">(</span>index<span class="token operator">=</span>vs<span class="token punctuation">[</span><span class="token string">'vehicle_type'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
     columns<span class="token operator">=</span>vs<span class="token punctuation">[</span><span class="token string">'salesman_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
     values <span class="token operator">=</span> vs<span class="token punctuation">[</span><span class="token string">'counts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>aggfunc <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>'以vehicle_type和salesman_name为分组键、
    counts为值\的汽车销售数据交叉透视表前<span class="token number">10</span>行<span class="token number">10</span>列
    为：\n'<span class="token punctuation">,</span>vsCross<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="转换数据-dataframe-数据离散化">转换数据–DataFrame 数据离散化</h2>
<p>在进行数据分析时，需要先了解数据的分布特征，如某个值的出现频次、不同的取值区间样本的多少，需要对数据的分布特征进行初步的了解。对于非数值类数据的统计可以使用<code>astype</code>方法将目标特征的数据类型转换为<code>category</code>类别</p>
<ul>
<li>Pandas 提供了按照变量值域进行等宽分割的<code>pandas.cut()</code>方法。</li>
<li>用户也可以使用 pandas.DataFrame.quantile()方法获得特征的具有相同位置间隔的不同分位数，使用<code>pandas.cut()</code>方法按照各个分位数切割区间，设计等频法离散化连续数据。</li>
</ul>
<h3 id="统计等值样本出现的频数">统计等值样本出现的频数</h3>
<p>要统计相同值样本出现的频数，Pandas 提供了<code>pandas.series.value_counts()方法</code>。其格式如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pythonSeries<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span>normalize<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> sort<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> dropna<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>pandas.series.value_counts()方法将 series 中的<strong>相同值看作一个类别</strong>，<strong>分别返回各个类别的记录数量</strong>，即频次，并根据 sort 的值决定是否按频次排序。<code>acending</code>按照频数升序或者降序。</p>
<h3 id="统计落入每个区间的频数-等宽法离散数据">统计落入每个区间的频数(等宽法离散数据)</h3>
<p>使用<code>pandas.cut()</code>方法和<code>pandas.series.value_counts()</code>方法，将数据值域分割为等宽的若干区间，并统计各个区间的样本数量。<br>
<strong>分割变量值域</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pythonpandas<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>x<span class="token punctuation">,</span> bins<span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> retbins<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
precision<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> include_lowest<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">'raise'</span><span class="token punctuation">)</span><span class="token comment">#right参数用来调整区间的类型（默认左开右闭）</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>其中 x 接收要分割的一维数组，bins 接收正整数，表示要分割为的区间数量。<br>
有的时候分割变量也会借助分位数进行分割，这个时候就要用到与 pd.cut()类似的 pd.qcut()方法，若传入 bins 为一个整数，则表示等分的区间个数，若传入的为一个值在 0-1 的列表，则会根据列表进行划分。<br>
统计样本数量，依然还用<code>pd.value_counts()方法</code>函数。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
ages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span>
bins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span>
cats <span class="token operator">=</span> pd<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>ages<span class="token punctuation">,</span> bins<span class="token punctuation">)</span>
<span class="token comment"># a special Categorical object</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>cats<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>cats<span class="token punctuation">.</span>categories<span class="token punctuation">)</span>  <span class="token comment"># 一个包含所有category名字的对象</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>cats<span class="token punctuation">.</span>codes<span class="token punctuation">)</span>  <span class="token comment"># 索引值返回</span>
pd<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span>cats<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#ch4-3,例4-4 查看汽车销售数据表的数值型特征的描述性统计</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
path<span class="token operator">=</span><span class="token string">'D:/my_python/ch04/data/'</span>
vs <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_table<span class="token punctuation">(</span>path<span class="token operator">+</span><span class="token string">'vehicle_sales.csv'</span><span class="token punctuation">,</span>
                      sep <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">'gbk'</span><span class="token punctuation">)</span>
<span class="token comment">#例4-8 等宽法离散化数据系列，各区间宽度大致相同，求各区间的频数</span>
k<span class="token operator">=</span><span class="token number">5</span><span class="token comment">#离散化为等宽的k个区间</span>
<span class="token comment">#返回k个区间，相当于k个类，以bins作为分割点</span>
<span class="token comment">#返回的amounts变成了series，value变成了区间。</span>
amounts<span class="token punctuation">,</span>bins<span class="token operator">=</span>pd<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>vs<span class="token punctuation">[</span><span class="token string">'amounts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>k<span class="token punctuation">,</span>retbins<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'销售额分割成'</span><span class="token punctuation">,</span>k<span class="token punctuation">,</span><span class="token string">'个等宽区间的分割点是：\n'</span><span class="token punctuation">,</span>bins<span class="token punctuation">)</span>
<span class="token comment">#统计各个区间记录的频数，**默认按照频数降序排列**</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'汽车销售额等宽离散化为5个区间后每个区间及其频数为：\n'</span><span class="token punctuation">,</span>
      amounts<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#可视化，按照区间从小到大排列</span>
<span class="token comment">#a_frequency=amounts.value_counts(sort=False)</span>
<span class="token comment">#可视化，按照频数降序排列</span>
a_frequency<span class="token operator">=</span>amounts<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>
labels<span class="token operator">=</span>a_frequency<span class="token punctuation">.</span>index<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>k<span class="token punctuation">]</span><span class="token comment">#将区间作为标签</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'SimHei'</span><span class="token comment">#设置字体为SimHei显示中文</span>
plt<span class="token punctuation">.</span>rc<span class="token punctuation">(</span><span class="token string">'font'</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token comment">#设置图中字号大小</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#设置画布</span>
plt<span class="token punctuation">.</span>bar<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span>a_frequency<span class="token punctuation">)</span><span class="token comment">#绘制柱状图</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'销售额等宽法频数统计图'</span><span class="token punctuation">)</span><span class="token comment">#添加标题</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'销售额'</span><span class="token punctuation">)</span><span class="token comment">#添加横轴标签</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'频数'</span><span class="token punctuation">)</span><span class="token comment">#添加y轴名称</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span>labels<span class="token punctuation">,</span>rotation<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token comment">#横轴刻度与标签对准</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="等频法离散数据">等频法离散数据</h3>
<p>对于不均匀分布的数据， 有时需要按<strong>大致相同的样本频次</strong>，观察取得这些频次的样本分布在的不同区间。称为等频法离散化数据，简称为等频法。</p>
<ul>
<li>将样本从小到大进行排列，按照样本位置将数据划分为位置间隔相等的区间。位置间隔相同意味着样本出现的频数相同。</li>
<li>获得每个区间的第一个和最后一个元素的值，两者的差值即为与该位置区间对应的元素取值区间。</li>
<li>使用 Pandas 的<code>DataFrame.quantile()</code>方法能够获得 DataFrame 的任意分位数，据此可以得到等频的样本值域分割点。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#例4-9 等频法离散化数据，各区间频数大致相同，求区间分割点。</span>
<span class="token comment">#自定义等频法离散化函数</span>
<span class="token keyword">def</span> <span class="token function">same_frequency_cut</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#产生k个分位数位置</span>
    w<span class="token operator">=</span>data<span class="token punctuation">.</span>quantile<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">1.0</span><span class="token operator">/</span>k<span class="token punctuation">,</span><span class="token number">1.0</span><span class="token operator">/</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span>
    data<span class="token operator">=</span>pd<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>data<span class="token punctuation">,</span>w<span class="token punctuation">)</span><span class="token comment">#按照分位数位置离散化data</span>
    <span class="token keyword">return</span> data
<span class="token comment">#返回的a_frequency变成了series，value变成了区间。</span>
a_frequency<span class="token operator">=</span> same_frequency_cut<span class="token punctuation">(</span>vs<span class="token punctuation">[</span><span class="token string">'amounts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'汽车销售额等频法离散化后各个类别数目分布状况为：'</span><span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">,</span>a_frequency<span class="token punctuation">)</span>
<span class="token comment">#可视化，按照区间从小到大排列</span>
a_frequency<span class="token operator">=</span>same_frequency_cut<span class="token punctuation">(</span>vs<span class="token punctuation">[</span><span class="token string">'amounts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span>sort<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
labels<span class="token operator">=</span>a_frequency<span class="token punctuation">.</span>index<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>k<span class="token punctuation">]</span><span class="token comment">#将区间作为标签</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#设置画布</span>
plt<span class="token punctuation">.</span>bar<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span>a_frequency<span class="token punctuation">)</span><span class="token comment">#绘制柱状图</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'销售额等频法频数统计图'</span><span class="token punctuation">)</span><span class="token comment">#添加标题</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'销售额'</span><span class="token punctuation">)</span><span class="token comment">#添加横轴标签</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'频数'</span><span class="token punctuation">)</span><span class="token comment">#添加y轴名称</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span>labels<span class="token punctuation">,</span>rotation<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token comment">#横轴刻度与标签对准</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="dataframe-描述性统计">DataFrame 描述性统计</h2>
<ul>
<li>
<p>单统计量</p>
<ul>
<li>最小值——<code>DataFrame.min(axis=None, skipna=None, level=None, numeric_only=None, **kwargs)</code>(skipna 是否除去缺失值)</li>
<li>最大值——<code>DataFrame.max(axis=None, skipna=None, level=None, numeric_only=None, **kwargs)</code></li>
<li>平均值——<code>DataFrame.mean(axis=None, skipna=None, level=None, numeric_only=None, **kwargs)</code></li>
<li>极差——<code>Series.ptp(axis=None, skipna=None, level=None, numeric_only=None, **kwargs)</code></li>
<li>方差——<code>DataFrame.var(axis=None, skipna=None, level=None, ddof=1, numeric_only=None, **kwargs)</code></li>
<li>标准差——<code>DataFrame.std(axis=None, skipna=None, level=None, ddof=1, numeric_only=None, **kwargs)</code></li>
<li>协方差——<code>DataFrame.cov(min_periods=None)</code></li>
<li>相关系数——<code>DataFrame.corr(method='pearson', min_periods=1)</code></li>
<li>标准误差——<code>Series.sem(axis=None, skipna=None, level=None, ddof=1, numeric_only=None, **kwargs)</code></li>
<li>众数——<code>DataFrame.mode(axis=0, numeric_only=False)</code></li>
<li>样本偏度——<code>DataFrame.skew(axis=None, skipna=None, level=None, numeric_only=None, **kwargs)</code></li>
<li>样本峰度——<code>Series.kurt(axis=None, skipna=None, level=None, numeric_only=None, **kwargs)</code></li>
<li>中位数——<code>DataFrame.median(axis=None, skipna=None, level=None, numeric_only=None, **kwargs)</code></li>
<li>分位数——<code>DataFrame.quantile(q=0.5, axis=0, numeric_only=True, interpolation='linear')</code></li>
<li>非空值数量——<code>DataFrame.count(axis=0, level=None, numeric_only=False)</code></li>
<li>平均绝对离差——<code>DataFrame.mad(axis=None, skipna=None, level=None)</code></li>
</ul>
<p><img src="../md_imgs/Pandas/47.png" alt="image.png"></p>
</li>
<li>
<p>多统计量<br>
<code>DataFrame.describe()</code>方法返回 DataFrame 全部或指定数值型字段的和、均值、标准差、最小值、最大值、25%分位数、50%分位数和 75%分位数。</p>
</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">DataFrame<span class="token punctuation">.</span>describe<span class="token punctuation">(</span>percentiles<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> include<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> exclude<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><code>DataFrame.describe()</code>函数也可以对 DataFrame 的 category 类型（非数值型）进行描述性统计，返回 count, unique, top,freq 值，分别代表记录的数量、类的数量、记录数量最多的类、记录数量最多的类的记录数量。<br>
要使用<code>DataFrame.describe()</code>函数查看非数值型字段，需要首先使用 Pandas 提供的<code>DataFrame.astype()</code>函数，将非数值型字段转换为 category 类型。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pythonDataFrame<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>dtype<span class="token punctuation">,</span> copy<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'raise'</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>令 dtype=’category’, 它将 DataFrame 强制转换为 category 类型。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#例4-6 使用.describe()对category类型进行描述性统计</span>
<span class="token comment">#类别型数据描述性统计，先将类别转换为category类型</span>
vs<span class="token punctuation">[</span><span class="token string">'vehicle_type'</span><span class="token punctuation">]</span><span class="token operator">=</span>vs<span class="token punctuation">[</span><span class="token string">'vehicle_type'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'category'</span><span class="token punctuation">)</span>
vs<span class="token punctuation">[</span><span class="token string">'salesman_name'</span><span class="token punctuation">]</span><span class="token operator">=</span>vs<span class="token punctuation">[</span><span class="token string">'salesman_name'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'category'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'汽车销售数据表车型、销售员的描述性统计为：\n'</span><span class="token punctuation">,</span>
      vs<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'vehicle_type'</span><span class="token punctuation">,</span><span class="token string">'salesman_name'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在利用上述函数对 DataFrame 进行统计量计算的时候，除了可以直接对 DataFrame 的全部字段进行计算外还可以通过指定多个字段采用类似<code>DataFrame[['column1_name','column2_name']].describe()</code> 的形式进行统计分析。<br>
当我们用数值来进行分类时，进行统计分析时如果不希望作为类别的数值列也被进行统计分析，可以专门将数值类的列转为非数值型数据（参考<a target="_blank" rel="noopener" href="https://www.wolai.com/ja8sUWa1mNMLptDoE9MT6z">综合实例–iris 数据集统计分析</a>代码块第 97 行）。</p>
<h2 id="协方差和相关系数">协方差和相关系数</h2>
<ul>
<li>df.cov()</li>
<li>df.corrwith(df2)</li>
</ul>
<h2 id="使用-groupby-拆分数据并进行描述性统计">使用 GroupBy 拆分数据并进行描述性统计</h2>
<p>Pandas 提供了 DataFrame.groupby()方法，按照指定的分组键，将具有相同键值的记录划分为同一组，将具有不同键值的记录划分到不同组，并对各组进行统计计算。其格式如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pythonDataFrame<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> level<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> as_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
sort<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> group_keys<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> squeeze<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> observed<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>其中 by 接收分组键。<code>DataFrame.groupby()</code>返回一个称为<strong>GroupBy object</strong>的对象。实际上分组后的数据对象 GroupBy 类似 Series 与 DataFrame，是 pandas 提供的一种对象。**分组后的结果不能直接查看，而是保存在内存中。**如果使用<code>print</code>打印，显示结果为分组结果为内存中保存的地址。<br>
对<code>GroupBy()</code>分组形成的对象,可以使用<code>get_group('group name')</code>方法返回组名为 group name 的全部记录。</p>
<ul>
<li>对分组结果 GroupBy object 的描述性统计
<ul>
<li><code>GroupBy object.count()</code>——返回每组记录数量，包括缺失值。</li>
<li><code>GroupBy object.max()</code>——返回组内最大值。</li>
<li><code>GroupBy object.min()</code>——返回组内最小值。</li>
<li><code>GroupBy object.sum()</code>——返回每组的和。</li>
<li><code>GroupBy object.mean()</code>——返回每组的均值。</li>
<li><code>GroupBy object.std()</code>——返回每组的标准差。</li>
<li><code>GroupBy object.median()</code>——返回每组的中位数。</li>
<li><code>GroupBy object.size()</code>——返回每组的大小。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#例4-10 对汽车销售数据表进行分组聚合，观察各个描述性统计</span>
vs<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token operator">=</span>pd<span class="token punctuation">.</span>to_datetime<span class="token punctuation">(</span>vs<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#将'date'转换成日期型</span>
<span class="token comment">#按照日期进行分组</span>
vsGroup <span class="token operator">=</span> vs<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'date'</span><span class="token punctuation">)</span>
<span class="token comment">#各个特征使用相同的函数统计计算</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'汽车销售数据表按日期分组后前5组每组的数量为：\n'</span><span class="token punctuation">,</span>
      vsGroup<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1>窗口函数</h1>
<p>在实际应用过程中，我们可能会存在对整个df的局部数据进行统计分析的场景，这时就需要用到所谓的“窗口函数”,可以理解为在整体数据集上创建窗口来进行运算，pd中提供的几种窗口函数有：</p>
<ul>
<li>rolling（移动函数）</li>
<li>expanding(扩展函数)</li>
<li>ewm（指数加权函数）</li>
</ul>
<blockquote>
<p>在数据分析的过程中，使用窗口函数能够提升数据的准确性，并且使数据曲线的变化趋势更加平滑，从而让数据分析变得更加准确、可靠。</p>
</blockquote>
<p>先咕咕了</p>
<h1>visualizations</h1>
<p>Series 和 Df 都有一个 plot 属性来进行基本的一些绘图，默认情况下 se/df.plot()等价于 se/df.plot.line()[绘制线性图]，可以通过调节传入参数对绘图进行修饰 plot 属性本身包含许多种绘图方式。<br>
df/se.plot 的方法：</p>
<ul>
<li>line()</li>
<li>bar()(index 作为横坐标)</li>
<li>barz()(index 作为纵坐标)</li>
<li>hist():</li>
<li>density():概率密度函数</li>
<li>kde()：使用 kde 方法进行估计</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://kebuaaa.github.io">可不</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://kebuaaa.github.io/Pandas/">https://kebuaaa.github.io/Pandas/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://kebuaaa.github.io" target="_blank">小明的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="../tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">数据分析</a><a class="post-meta__tags" href="../tags/Python%E5%BA%93/">Python库</a><a class="post-meta__tags" href="../tags/Pandas/">Pandas</a></div><div class="post_share"><div class="social-share" data-image="https://images.pexels.com/photos/159866/books-book-pages-read-literature-159866.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=600" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="../Python%E7%9A%84%E6%8A%BD%E8%B1%A1%E9%AD%94%E6%B3%95--%E7%B1%BB/"><img class="prev-cover" src="https://images.pexels.com/photos/317355/pexels-photo-317355.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=600" onerror="onerror=null;src='https://images.pexels.com/photos/374918/pexels-photo-374918.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=600'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Python的抽象魔法--类</div></div></a></div><div class="next-post pull-right"><a href="../Perceptron%EF%BC%8CLR%20and%20Boosting/"><img class="next-cover" src="https://images.pexels.com/photos/768125/pexels-photo-768125.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=600" onerror="onerror=null;src='https://images.pexels.com/photos/374918/pexels-photo-374918.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=600'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Perceptron，LR and Boosting</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="../Matplotlib%E5%BA%93/" title="Matplotlib库"><img class="cover" src="https://images.pexels.com/photos/159866/books-book-pages-read-literature-159866.jpeg?auto=compress&cs=tinysrgb&w=600" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-26</div><div class="title">Matplotlib库</div></div></a></div><div><a href="../Numpy%EF%BC%88numerical%20%20Python%EF%BC%89/" title="Numpy（numerical  Python）"><img class="cover" src="https://images.pexels.com/photos/317355/pexels-photo-317355.jpeg?auto=compress&cs=tinysrgb&w=600" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-26</div><div class="title">Numpy（numerical  Python）</div></div></a></div><div><a href="../Seaborn%E5%BA%93%E7%AE%80%E4%BB%8B/" title="Seaborn库简介"><img class="cover" src="https://images.pexels.com/photos/317355/pexels-photo-317355.jpeg?auto=compress&cs=tinysrgb&w=600" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-26</div><div class="title">Seaborn库简介</div></div></a></div><div><a href="../Data%20Visualization/" title="Data Visualization"><img class="cover" src="https://images.pexels.com/photos/159866/books-book-pages-read-literature-159866.jpeg?auto=compress&cs=tinysrgb&w=600" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-26</div><div class="title">Data Visualization</div></div></a></div><div><a href="../SQL/" title="SQL"><img class="cover" src="https://images.pexels.com/photos/768125/pexels-photo-768125.jpeg?auto=compress&cs=tinysrgb&w=600" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-26</div><div class="title">SQL</div></div></a></div><div><a href="../%E4%BA%A7%E7%94%9F%E5%92%8C%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E9%9B%86/" title="产生和加载数据集"><img class="cover" src="https://images.pexels.com/photos/159866/books-book-pages-read-literature-159866.jpeg?auto=compress&cs=tinysrgb&w=600" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-26</div><div class="title">产生和加载数据集</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">速查表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">Pandas 数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#series"><span class="toc-number">3.1.</span> <span class="toc-text">Series</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dataframe"><span class="toc-number">3.2.</span> <span class="toc-text">DataFrame</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%EF%BC%9A"><span class="toc-number">3.2.1.</span> <span class="toc-text">属性：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.2.</span> <span class="toc-text">方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-dataframe"><span class="toc-number">3.2.3.</span> <span class="toc-text">创建 DataFrame</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E7%AD%BE%E9%87%8D%E5%91%BD%E5%90%8D"><span class="toc-number">3.3.</span> <span class="toc-text">标签重命名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%BA%A7%E7%B4%A2%E5%BC%95"><span class="toc-number">3.4.</span> <span class="toc-text">多级索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E5%88%97%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BA%92%E7%9B%B8%E8%BD%AC%E5%8C%96"><span class="toc-number">3.4.1.</span> <span class="toc-text">行列索引的互相转化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#series-df"><span class="toc-number">3.4.1.1.</span> <span class="toc-text">Series&#x2F;df</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#df-%E7%9A%84%E9%87%8D%E7%BD%AE%E7%B4%A2%E5%BC%95"><span class="toc-number">3.4.1.2.</span> <span class="toc-text">df 的重置索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#multiindex-%E5%88%9B%E5%BB%BA"><span class="toc-number">3.4.1.3.</span> <span class="toc-text">MultiIndex 创建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reordering-and-sorting-levels"><span class="toc-number">3.4.1.4.</span> <span class="toc-text">Reordering and Sorting levels</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE-dataframe"><span class="toc-number">3.4.2.</span> <span class="toc-text">访问 DataFrame</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AD%97%E5%85%B8%E6%96%B9%E5%BC%8F%E8%AE%BF%E9%97%AE-dataframe"><span class="toc-number">3.4.2.1.</span> <span class="toc-text">使用字典方式访问 DataFrame。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%B1%9E%E6%80%A7%E6%96%B9%E5%BC%8F%E8%AE%BF%E9%97%AE"><span class="toc-number">3.4.2.2.</span> <span class="toc-text">使用属性方式访问</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%A1%8C%E7%9A%84%E7%89%B9%E6%AE%8A%E6%96%B9%E6%B3%95"><span class="toc-number">3.4.2.3.</span> <span class="toc-text">访问行的特殊方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E6%95%B0%E6%A0%87%E7%AD%BE%E7%9A%84%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5"><span class="toc-number">3.4.2.4.</span> <span class="toc-text">整数标签的特殊情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%87%E7%89%87%E8%AE%BF%E9%97%AE%E6%96%B9%E6%B3%95"><span class="toc-number">3.4.2.5.</span> <span class="toc-text">切片访问方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9-dataframe-%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">3.4.3.</span> <span class="toc-text">更改 DataFrame 中的数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sorting-and-ranking"><span class="toc-number">3.4.4.</span> <span class="toc-text">Sorting and Ranking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#transposing"><span class="toc-number">3.4.5.</span> <span class="toc-text">Transposing</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#index-object"><span class="toc-number">3.5.</span> <span class="toc-text">Index object</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#reindex"><span class="toc-number">3.5.1.</span> <span class="toc-text">Reindex</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E6%A0%87%E7%AD%BE%E4%B8%8B%E7%9A%84%E8%BD%B4%E7%B4%A2%E5%BC%95"><span class="toc-number">3.5.1.1.</span> <span class="toc-text">重复标签下的轴索引</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E7%89%B9%E5%AE%9A%E5%80%BC"><span class="toc-number">3.6.</span> <span class="toc-text">查找特定值</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">基本用法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#pandas-%E8%AF%BB%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.</span> <span class="toc-text">Pandas 读写文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.1.</span> <span class="toc-text">读写文本文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%86%99-excel-%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.2.</span> <span class="toc-text">读写 Excel 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.3.</span> <span class="toc-text">读写二进制文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#hdf5"><span class="toc-number">4.1.3.1.</span> <span class="toc-text">HDF5</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#interacting-with-databases"><span class="toc-number">4.1.4.</span> <span class="toc-text">Interacting with Databases</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E5%92%8C%E6%95%B0%E6%8D%AE%E5%AF%B9%E9%BD%90"><span class="toc-number">4.2.</span> <span class="toc-text">算术运算和数据对齐</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#df-%E5%92%8C-ser-%E4%B9%8B%E9%97%B4%E7%9A%84%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97"><span class="toc-number">4.2.1.</span> <span class="toc-text">Df 和 Ser 之间的算术运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97"><span class="toc-number">4.2.2.</span> <span class="toc-text">数学运算</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2"><span class="toc-number">4.3.</span> <span class="toc-text">数据转换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2"><span class="toc-number">4.3.1.</span> <span class="toc-text">数据转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#df-replace"><span class="toc-number">4.3.2.</span> <span class="toc-text">df.replace()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#df-str-replace"><span class="toc-number">4.3.3.</span> <span class="toc-text">df.str.replace</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%95%B0%E6%8D%AE"><span class="toc-number">4.4.</span> <span class="toc-text">时间序列数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-number">4.4.1.</span> <span class="toc-text">创建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#timestamp-%E6%97%B6%E9%97%B4%E7%82%B9"><span class="toc-number">4.4.1.1.</span> <span class="toc-text">Timestamp–时间点</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7"><span class="toc-number">4.4.1.1.1.</span> <span class="toc-text">常用属性</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#datetimeindex-%E4%B8%8E-periodindex-%E5%87%BD%E6%95%B0"><span class="toc-number">4.4.1.2.</span> <span class="toc-text">DatetimeIndex 与 PeriodIndex 函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%90%8D%E7%A7%B0%E5%8F%8A%E8%AF%B4%E6%98%8E"><span class="toc-number">4.4.1.2.1.</span> <span class="toc-text">参数名称及说明</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#timedelta-%E4%B8%8D%E5%90%8C%E5%8D%95%E4%BD%8D%E7%9A%84%E6%97%B6%E9%97%B4"><span class="toc-number">4.4.1.3.</span> <span class="toc-text">Timedelta–不同单位的时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#timedeltaindex"><span class="toc-number">4.4.1.4.</span> <span class="toc-text">TimedeltaIndex</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE"><span class="toc-number">4.4.2.</span> <span class="toc-text">访问</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E7%BB%AD%E5%BA%8F%E5%88%97%E4%BA%A7%E7%94%9F-frequencies"><span class="toc-number">4.4.3.</span> <span class="toc-text">连续序列产生&amp;Frequencies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E9%A2%91%E7%8E%87%E7%9A%84%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E7%94%9F%E6%88%90-%E9%A2%91%E7%8E%87%E8%BD%AC%E6%8D%A2%E5%92%8C%E9%87%8D%E9%87%87%E6%A0%B7"><span class="toc-number">4.4.4.</span> <span class="toc-text">指定频率的时间序列生成(频率转换和重采样)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#frequencies-and-date-offsets"><span class="toc-number">4.4.5.</span> <span class="toc-text">Frequencies and Date Offsets</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#period-%E6%97%B6%E9%97%B4%E8%B7%A8%E5%BA%A6%E6%88%96%E6%97%B6%E9%97%B4%E6%AE%B5"><span class="toc-number">4.4.5.1.</span> <span class="toc-text">Period–时间跨度或时间段</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#periodtimeindex"><span class="toc-number">4.4.5.1.1.</span> <span class="toc-text">PeriodtimeIndex</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#period-frequency-conversion"><span class="toc-number">4.4.5.1.1.1.</span> <span class="toc-text">Period Frequency Conversion</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shifting-leading-and-lagging-data"><span class="toc-number">4.5.</span> <span class="toc-text">Shifting (Leading and Lagging) Data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%8E%92%E5%88%97-permutation-%E5%92%8C%E9%9A%8F%E6%9C%BA%E6%8A%BD%E6%A0%B7"><span class="toc-number">4.6.</span> <span class="toc-text">总体的随机排列（permutation）和随机抽样</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E6%8E%92%E5%88%97"><span class="toc-number">4.6.1.</span> <span class="toc-text">随机排列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E6%8A%BD%E6%A0%B7"><span class="toc-number">4.6.2.</span> <span class="toc-text">随机抽样</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">pandas 统计分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86"><span class="toc-number">5.1.</span> <span class="toc-text">数据预处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#data-cleaning"><span class="toc-number">5.1.1.</span> <span class="toc-text">Data Cleaning</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%BB%E9%87%8D"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">去重</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E5%A4%B1%E5%80%BC%E6%8F%92%E8%A1%A5"><span class="toc-number">5.1.1.2.</span> <span class="toc-text">缺失值插补</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%88%AA%E6%96%AD"><span class="toc-number">5.1.1.3.</span> <span class="toc-text">截断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%80%BC%E6%A3%80%E6%B5%8B"><span class="toc-number">5.1.1.4.</span> <span class="toc-text">异常值检测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2%E6%95%B0%E6%8D%AE-%E5%93%91%E5%8F%98%E9%87%8F%E5%A4%84%E7%90%86-index-dummy-variables"><span class="toc-number">5.1.1.5.</span> <span class="toc-text">转换数据–哑变量处理（Index&#x2F;dummy Variables）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%95%B0%E6%8D%AE"><span class="toc-number">5.1.1.6.</span> <span class="toc-text">字符串数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E7%BD%AE%E7%B4%A2%E5%BC%95"><span class="toc-number">5.1.1.7.</span> <span class="toc-text">重置索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%AD%9B%E9%80%89"><span class="toc-number">5.1.1.8.</span> <span class="toc-text">数据筛选</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%95%B4%E7%90%86"><span class="toc-number">5.1.2.</span> <span class="toc-text">数据整理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E5%90%88%E5%B9%B6%E6%95%B0%E6%8D%AE"><span class="toc-number">5.1.2.1.</span> <span class="toc-text">堆叠合并数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%87%8D%E5%A1%91"><span class="toc-number">5.1.2.2.</span> <span class="toc-text">数据重塑</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%8C%E5%88%97%E7%B4%A2%E5%BC%95%E7%9A%84%E9%87%8D%E5%A1%91"><span class="toc-number">5.1.2.2.1.</span> <span class="toc-text">行列索引的重塑</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%8C%E5%88%97%E5%80%BC%E7%9A%84%E9%87%8D%E5%A1%91-%E6%95%B0%E6%8D%AE%E9%80%8F%E8%A7%86-%E9%80%86%E8%BF%90%E7%AE%97-long-wide"><span class="toc-number">5.1.2.2.2.</span> <span class="toc-text">行列值的重塑（数据透视+逆运算，long→wide）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#wide-long"><span class="toc-number">5.1.2.2.3.</span> <span class="toc-text">wide→long</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%87%E5%87%86%E5%8C%96"><span class="toc-number">5.1.3.</span> <span class="toc-text">数据标准化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E7%BB%84%E5%92%8C%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C"><span class="toc-number">5.2.</span> <span class="toc-text">数据分组和聚合操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84"><span class="toc-number">5.2.1.</span> <span class="toc-text">分组</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#groupby-object"><span class="toc-number">5.2.1.1.</span> <span class="toc-text">Groupby object</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88"><span class="toc-number">5.2.2.</span> <span class="toc-text">聚合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-agg-%E6%96%B9%E6%B3%95%E8%81%9A%E5%90%88%E6%95%B0%E6%8D%AE"><span class="toc-number">5.2.3.</span> <span class="toc-text">使用 agg 方法聚合数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-apply-%E6%96%B9%E6%B3%95%E8%81%9A%E5%90%88%E6%95%B0%E6%8D%AE"><span class="toc-number">5.2.4.</span> <span class="toc-text">使用 apply 方法聚合数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-transform-%E6%96%B9%E6%B3%95%E8%81%9A%E5%90%88%E6%95%B0%E6%8D%AE"><span class="toc-number">5.2.5.</span> <span class="toc-text">使用 transform 方法聚合数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%8F%E8%A7%86%E8%A1%A8%E5%92%8C%E4%BA%A4%E5%8F%89%E8%A1%A8"><span class="toc-number">5.3.</span> <span class="toc-text">透视表和交叉表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-pivot-table-%E5%88%9B%E5%BB%BA%E9%80%8F%E8%A7%86%E8%A1%A8"><span class="toc-number">5.3.1.</span> <span class="toc-text">使用 pivot_table 创建透视表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-crosstab-%E5%88%9B%E5%BB%BA%E4%BA%A4%E5%8F%89%E8%A1%A8"><span class="toc-number">5.3.2.</span> <span class="toc-text">使用 crosstab 创建交叉表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2%E6%95%B0%E6%8D%AE-dataframe-%E6%95%B0%E6%8D%AE%E7%A6%BB%E6%95%A3%E5%8C%96"><span class="toc-number">5.4.</span> <span class="toc-text">转换数据–DataFrame 数据离散化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E7%AD%89%E5%80%BC%E6%A0%B7%E6%9C%AC%E5%87%BA%E7%8E%B0%E7%9A%84%E9%A2%91%E6%95%B0"><span class="toc-number">5.4.1.</span> <span class="toc-text">统计等值样本出现的频数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E8%90%BD%E5%85%A5%E6%AF%8F%E4%B8%AA%E5%8C%BA%E9%97%B4%E7%9A%84%E9%A2%91%E6%95%B0-%E7%AD%89%E5%AE%BD%E6%B3%95%E7%A6%BB%E6%95%A3%E6%95%B0%E6%8D%AE"><span class="toc-number">5.4.2.</span> <span class="toc-text">统计落入每个区间的频数(等宽法离散数据)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%89%E9%A2%91%E6%B3%95%E7%A6%BB%E6%95%A3%E6%95%B0%E6%8D%AE"><span class="toc-number">5.4.3.</span> <span class="toc-text">等频法离散数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dataframe-%E6%8F%8F%E8%BF%B0%E6%80%A7%E7%BB%9F%E8%AE%A1"><span class="toc-number">5.5.</span> <span class="toc-text">DataFrame 描述性统计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%8F%E6%96%B9%E5%B7%AE%E5%92%8C%E7%9B%B8%E5%85%B3%E7%B3%BB%E6%95%B0"><span class="toc-number">5.6.</span> <span class="toc-text">协方差和相关系数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-groupby-%E6%8B%86%E5%88%86%E6%95%B0%E6%8D%AE%E5%B9%B6%E8%BF%9B%E8%A1%8C%E6%8F%8F%E8%BF%B0%E6%80%A7%E7%BB%9F%E8%AE%A1"><span class="toc-number">5.7.</span> <span class="toc-text">使用 GroupBy 拆分数据并进行描述性统计</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">窗口函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">visualizations</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://images.pexels.com/photos/159866/books-book-pages-read-literature-159866.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=600')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 可不</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="../js/utils.js"></script><script src="../js/main.js"></script><script src="../js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'c7GEX67zIq8BwxrCJCcnCNGJ-gzGzoHsz',
      appKey: 'sMi0vKwORQNhvze51vwvkmep',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="/Scripts/js/snowflake.js"></script><script src="/Scripts/js/beijing.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>